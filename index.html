<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramientas Contables - Estudio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="index-styles.css">
</head>
<body>
    <script src="check-auth.js"></script>

    <!-- Men√∫ superior de bases de datos compartidas -->
    <div class="data-menu">
        <div class="data-menu-container">
            <div class="data-menu-title">
                <span class="data-menu-icon">üóÑÔ∏è</span>
                <span>Bases de Datos Compartidas</span>
            </div>
            <div class="data-menu-buttons">
                <button id="btnClients" class="data-btn">
                    <span>üë•</span>
                    <span>Clientes</span>
                    <span class="data-count" id="clientCount">0</span>
                </button>
                <button id="btnTaxes" class="data-btn">
                    <span>üìä</span>
                    <span>Impuestos</span>
                    <span class="data-count" id="taxCount">0</span>
                </button>
                <button id="btnStorage" class="data-btn">
                    <span>üíæ</span>
                    <span>Almacenamiento</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Indicador de Cliente Activo -->
    <div id="clienteActivoIndicador" style="background: #f0f9ff; border-left: 4px solid #3b82f6; padding: 12px 20px; margin-bottom: 20px; display: none;"></div>

    <div class="container">
        <div class="header">
            <h1>üßÆ Herramientas Contables</h1>
            <p>Suite de herramientas desarrolladas para optimizar procesos del estudio</p>
        </div>

        <div class="tools-grid">
            <!-- Herramienta 1: Convertidor Mercado Pago -->
            <a href="herramientas/mercado-pago-converter/" class="tool-card">
                <div class="tool-icon">üìä</div>
                <h2>Convertidor Mercado Pago</h2>
                <p>Convierte extractos de Mercado Pago a formato de extracto bancario contable con desagregaci√≥n completa de movimientos.</p>
                <ul class="tool-features">
                    <li>Procesamiento m√∫ltiple de archivos</li>
                    <li>Desagregaci√≥n de comisiones e impuestos</li>
                    <li>Exportaci√≥n a Excel</li>
                    <li>Validaci√≥n autom√°tica de saldos</li>
                </ul>
                <span class="badge">Disponible</span>
            </a>

            <!-- Herramienta 2: Conversor de Asientos Contables -->
            <a href="herramientas/conversor-asientos/" class="tool-card">
                <div class="tool-icon">üìù</div>
                <h2>Conversor de Asientos Contables</h2>
                <p>Convierte datos de diferentes or√≠genes (extractos bancarios, VEPs, compensaciones, registros) a formato de asientos contables para importar.</p>
                <ul class="tool-features">
                    <li>Soporte para m√∫ltiples or√≠genes</li>
                    <li>Gesti√≥n de clientes y planes de cuentas</li>
                    <li>Asignaci√≥n inteligente de cuentas</li>
                    <li>Exportaci√≥n lista para importar</li>
                </ul>
                <span class="badge">Disponible</span>
            </a>

            <!-- Herramienta 3: Conversor de Extractos Bancarios -->
            <a href="herramientas/extractos-bancarios/" class="tool-card">
                <div class="tool-icon">üè¶</div>
                <h2>Conversor de Extractos Bancarios</h2>
                <p>Convierte extractos bancarios y de inversiones de PDF a Excel para facilitar el an√°lisis y la contabilizaci√≥n.</p>
                <ul class="tool-features">
                    <li>Soporte para Banco Galicia y BBVA</li>
                    <li>Extractos bancarios e inversiones</li>
                    <li>Extracci√≥n autom√°tica de movimientos</li>
                    <li>Exportaci√≥n a Excel con formato</li>
                </ul>
                <span class="badge">Disponible</span>
            </a>

            <!-- Herramienta 4: Gesti√≥n de Comprobantes -->
            <a href="herramientas/gestion-comprobantes/" class="tool-card">
                <div class="tool-icon">üìã</div>
                <h2>Gesti√≥n de Comprobantes</h2>
                <p>Sistema completo para que los clientes suban comprobantes y el estudio gestione per√≠odos, vinculaciones y √≥rdenes de pago con integraci√≥n a Supabase.</p>
                <ul class="tool-features">
                    <li>Carga de comprobantes por clientes</li>
                    <li>Gesti√≥n de per√≠odos contables</li>
                    <li>C√°lculo de retenciones RG 830</li>
                    <li>√ìrdenes de pago y reportes</li>
                </ul>
                <span class="badge">Disponible</span>
            </a>
        </div>

        <div class="footer">
            <p>Desarrollado con Claude Code para el estudio contable</p>
            <p style="margin-top: 10px; font-size: 12px; opacity: 0.7;">
                Todas las herramientas funcionan localmente en tu navegador. No se env√≠an datos a servidores externos.
            </p>
        </div>
    </div>

    <!-- Modal Gesti√≥n de Clientes -->
    <div id="modalClients" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë• Gesti√≥n de Clientes</h2>
                <button class="close-btn" id="btnCloseClients">‚úï</button>
            </div>

            <div class="search-box">
                <input type="text" id="clientSearchInput" class="search-input" placeholder="üîç Buscar cliente por nombre o CUIT...">
            </div>

            <div class="btn-group mb-4">
                <button id="btnNewClient" class="btn-primary flex-1">+ Nuevo Cliente</button>
                <button id="btnDownloadTemplate" class="btn-secondary flex-1">üì• Descargar Plantilla</button>
                <label class="btn-secondary flex-1" style="cursor: pointer; text-align: center;">
                    üì§ Importar Clientes
                    <input type="file" id="importClientsFile" accept=".xlsx,.xls" style="display: none;">
                </label>
            </div>
            <div class="info-box" style="font-size: 12px; padding: 10px; margin-bottom: 16px;">
                <strong>Formato Excel:</strong> razon_social | cuit<br>
                <strong>Plantilla:</strong> Descarga la plantilla Excel con el formato correcto para importar clientes
            </div>

            <div id="clientsStats" class="clients-stats"></div>
            <div id="clientsList" class="clients-list"></div>
        </div>
    </div>

    <!-- Modal Nuevo Cliente -->
    <div id="modalNewClient" class="modal hidden">
        <div class="modal-content-sm">
            <h3>Nuevo Cliente</h3>
            <input type="text" id="newClientName" placeholder="Raz√≥n Social" class="input-text mb-4">
            <input type="text" id="newClientCuit" placeholder="CUIT (Opcional)" class="input-text mb-4">
            <div class="btn-group">
                <button id="btnCancelNewClient" class="btn-secondary">Cancelar</button>
                <button id="btnCreateClient" class="btn-primary">Crear</button>
            </div>
        </div>
    </div>

    <!-- Modal Gesti√≥n de Impuestos -->
    <div id="modalTaxes" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Base de Datos de Impuestos</h2>
                <button class="close-btn" id="btnCloseTaxes">‚úï</button>
            </div>
            <label class="btn-primary mb-4" style="cursor: pointer; text-align: center; display: block;">
                üì• Importar Base de Impuestos
                <input type="file" id="importTaxFile" accept=".xlsx,.xls" style="display: none;">
            </label>
            <div class="info-box" style="font-size: 12px; padding: 10px; margin-bottom: 16px;">
                <strong>Formato Excel:</strong> Impuesto | Concepto | Subconcepto
            </div>
            <div id="taxStats" style="margin-bottom: 16px; color: #64748b;"></div>
            <div class="preview-container">
                <div class="preview-header">
                    <h4>Vista Previa de la Base (Primeras 50 filas)</h4>
                </div>
                <div class="preview-table-container" style="max-height: 400px;">
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>Impuesto</th>
                                <th>Concepto</th>
                                <th>Subconcepto</th>
                            </tr>
                        </thead>
                        <tbody id="taxTableBody"></tbody>
                    </table>
                </div>
            </div>
            <button id="btnClearTaxDatabase" class="btn-secondary mt-4" style="width: 100%;">Limpiar Base de Datos</button>
        </div>
    </div>

    <!-- Modal Almacenamiento -->
    <div id="modalStorage" class="modal hidden">
        <div class="modal-content-sm">
            <div class="modal-header">
                <h2>üíæ Estad√≠sticas de Almacenamiento</h2>
                <button class="close-btn" id="btnCloseStorage">‚úï</button>
            </div>
            <div id="storageStats"></div>
            <button id="btnRefreshStorage" class="btn-secondary mt-4" style="width: 100%;">Actualizar</button>
        </div>
    </div>

    <!-- Modal Plan de Cuentas -->
    <div id="modalPlanCuentas" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Plan de Cuentas - <span id="planCuentasClienteNombre"></span></h2>
                <button class="close-btn" id="btnClosePlanCuentas">‚úï</button>
            </div>

            <div class="btn-group mb-4">
                <button id="btnDescargarPlantillaPlan" class="btn-secondary flex-1">üì• Descargar Plantilla Plan</button>
                <label class="btn-primary flex-1" style="cursor: pointer; text-align: center;">
                    üì§ Importar Plan
                    <input type="file" id="importPlanFile" accept=".xlsx,.xls" style="display: none;">
                </label>
                <button id="btnNuevaCuenta" class="btn-primary flex-1">+ Nueva Cuenta</button>
            </div>

            <div class="info-box" style="font-size: 12px; padding: 10px; margin-bottom: 16px;">
                <strong>Formato Excel:</strong> codigo | cuenta | tipo<br>
                <strong>Tipos v√°lidos:</strong> Activo, Pasivo, Patrimonio Neto, Ingreso, Egreso
            </div>

            <div id="planCuentasStats" class="clients-stats"></div>
            <div id="planCuentasList" style="max-height: 500px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Modal Nueva Cuenta -->
    <div id="modalNuevaCuenta" class="modal hidden">
        <div class="modal-content-sm">
            <h3>Nueva Cuenta</h3>
            <input type="text" id="nuevaCuentaCodigo" placeholder="C√≥digo (ej: 1.1.1.01)" class="input-text mb-4">
            <input type="text" id="nuevaCuentaNombre" placeholder="Nombre de la Cuenta" class="input-text mb-4">
            <select id="nuevaCuentaTipo" class="input-text mb-4">
                <option value="">Seleccionar Tipo</option>
                <option value="Activo">Activo</option>
                <option value="Pasivo">Pasivo</option>
                <option value="Patrimonio Neto">Patrimonio Neto</option>
                <option value="Ingreso">Ingreso</option>
                <option value="Egreso">Egreso</option>
            </select>
            <div class="btn-group">
                <button id="btnCancelNuevaCuenta" class="btn-secondary">Cancelar</button>
                <button id="btnCrearCuenta" class="btn-primary">Crear</button>
            </div>
        </div>
    </div>

    <!-- Configuraci√≥n de Supabase -->
    <script src="supabase-config.js"></script>
    <script src="clientes-simple.js"></script>
    <script src="plan-cuentas.js"></script>
    <script src="supabase-integration.js"></script>

    <!-- M√≥dulos compartidos -->
    <script src="shared/dataStore.js"></script>
    <script src="shared/clientManager.js"></script>
    <script src="shared/taxManager.js"></script>

    <!-- Script principal -->
    <script src="index-script.js"></script>
</body>
</html>
