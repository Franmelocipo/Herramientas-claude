<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conciliador Bancario</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../supabase-config.js"></script>
    <link rel="stylesheet" href="../../css/buttons.css">
    <link rel="stylesheet" href="../../shared/globalNav.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script src="../../check-auth.js"></script>
    <div class="nav-bar">
        <a href="../../index.html" class="nav-btn" title="Volver al inicio">
            <span class="nav-icon">üè†</span>
            <span class="nav-text">Inicio</span>
        </a>
        <a href="../../index.html" class="nav-btn" title="Men√∫ principal">
            <span class="nav-icon">‚Üê</span>
            <span class="nav-text">Volver</span>
        </a>
    </div>

    <!-- Panel de informaci√≥n de conciliaci√≥n (fixed) -->
    <div id="panelInfoConciliacion" class="panel-info-conciliacion hidden">
        <div class="panel-info-content">
            <div class="panel-info-section panel-info-cliente">
                <span class="panel-info-icon">üë§</span>
                <span class="panel-info-value" id="panelClienteNombre" title="">-</span>
            </div>
            <div class="panel-info-divider"></div>
            <div class="panel-info-section panel-info-cuenta">
                <span class="panel-info-icon">üè¶</span>
                <span class="panel-info-value" id="panelCuentaNombre" title="">-</span>
            </div>
            <div class="panel-info-divider"></div>
            <div class="panel-info-section panel-info-tipo">
                <span class="panel-info-icon" id="panelTipoIcon">üìä</span>
                <span class="panel-info-value" id="panelTipoNombre">-</span>
            </div>
            <div class="panel-info-divider"></div>
            <div class="panel-info-section panel-info-periodo">
                <span class="panel-info-icon">üìÖ</span>
                <span class="panel-info-value" id="panelPeriodo">-</span>
            </div>
            <div class="panel-info-divider hide-mobile"></div>
            <div class="panel-info-section panel-info-estado hide-mobile">
                <span class="panel-info-icon" id="panelEstadoIcon">‚è≥</span>
                <span class="panel-info-value" id="panelEstado">Configurando</span>
            </div>
            <!-- Conciliaci√≥n guardada inline -->
            <div id="panelInfoGuardada" class="panel-info-guardada hidden">
                <span class="panel-guardada-icon">üíæ</span>
                <span class="panel-guardada-nombre" id="panelNombreConciliacion">-</span>
            </div>
        </div>
    </div>
    <!-- Spacer para compensar el panel fixed -->
    <div id="panelInfoSpacer" class="panel-info-spacer"></div>

    <div class="container">
        <div class="card">
            <div class="header">
                <h1>üîÑ Conciliador Bancario</h1>
                <p class="subtitle">Compara movimientos del Mayor Contable con Extractos Bancarios</p>
            </div>

            <!-- Paso 1: Selecci√≥n de cliente -->
            <div class="step" id="step-cliente">
                <h2 class="step-title">
                    <span class="step-number">1</span>
                    Seleccionar cliente
                </h2>
                <div class="selector-cliente-wrapper">
                    <div class="search-select-wrapper">
                        <input type="text" id="clienteSearchPrincipal" placeholder="Buscar cliente por nombre o CUIT..." class="search-input search-input-large" oninput="filtrarClientesPrincipal()">
                        <select id="clienteSelectPrincipal" class="select-large" onchange="seleccionarClientePrincipal()">
                            <option value="">-- Seleccione un cliente --</option>
                        </select>
                    </div>
                    <div id="clienteSeleccionadoInfo" class="cliente-seleccionado-info hidden">
                        <span class="cliente-info-icon">‚úÖ</span>
                        <span class="cliente-info-nombre" id="clienteInfoNombre"></span>
                        <button class="btn-cambiar-cliente" onclick="cambiarCliente()">Cambiar</button>
                    </div>
                </div>
            </div>

            <!-- Paso 2: Selecci√≥n de cuenta bancaria -->
            <div class="step hidden" id="step-cuenta">
                <h2 class="step-title">
                    <span class="step-number">2</span>
                    Seleccionar cuenta bancaria
                </h2>
                <div class="selector-cuenta-wrapper">
                    <select id="cuentaSelectPrincipal" class="select-large" onchange="seleccionarCuentaPrincipal()">
                        <option value="">-- Seleccione una cuenta --</option>
                    </select>
                    <div id="cuentaSeleccionadaInfo" class="cuenta-seleccionada-info hidden">
                        <div class="cuenta-info-header">
                            <span class="cuenta-info-icon">üè¶</span>
                            <span class="cuenta-info-nombre" id="cuentaInfoNombre"></span>
                        </div>
                        <div class="extracto-auto-info" id="extractoAutoInfo">
                            <span class="extracto-auto-icon">üìã</span>
                            <span class="extracto-auto-text">Los extractos se cargar√°n autom√°ticamente de Auditor√≠a</span>
                        </div>
                        <div class="gestion-btn-wrapper">
                            <button id="btnGestionConciliaciones" class="btn-gestion-conciliaciones" onclick="abrirGestionConciliaciones()" disabled>
                                <span>üìÇ</span> Gestionar Conciliaciones Guardadas
                            </button>
                        </div>
                        <!-- Informaci√≥n de conciliaci√≥n cargada -->
                        <div id="conciliacionCargadaWrapper" class="conciliacion-cargada-wrapper hidden">
                            <div class="conciliacion-cargada-info">
                                <span class="conciliacion-cargada-icon">üìÑ</span>
                                <span class="conciliacion-cargada-label">Trabajando en:</span>
                                <span id="nombreConciliacionCargada" class="conciliacion-cargada-nombre"></span>
                            </div>
                            <button class="btn-eliminar-cargada" onclick="confirmarEliminarConciliacionCargada()" title="Eliminar esta conciliaci√≥n de la base de datos">
                                üóëÔ∏è Eliminar
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Rango de fechas para extractos -->
                <div id="rangoExtractosSection" class="rango-extractos-section hidden">
                    <h4>Per√≠odo a conciliar:</h4>
                    <div class="rango-fechas-inputs">
                        <div class="rango-input">
                            <label for="rangoDesde">Desde:</label>
                            <select id="rangoDesde" onchange="actualizarExtractosSeleccionados()">
                                <option value="">-- Mes/A√±o --</option>
                            </select>
                        </div>
                        <div class="rango-input">
                            <label for="rangoHasta">Hasta:</label>
                            <select id="rangoHasta" onchange="actualizarExtractosSeleccionados()">
                                <option value="">-- Mes/A√±o --</option>
                            </select>
                        </div>
                    </div>
                    <div id="extractoPreviewInfo" class="extracto-preview-info hidden">
                        <span id="extractoMovimientosCount"></span>
                    </div>
                </div>
            </div>

            <!-- Paso 3: Carga de Mayor Contable -->
            <div class="step hidden" id="step-mayor">
                <h2 class="step-title">
                    <span class="step-number">3</span>
                    Cargar Mayor Contable
                </h2>
                <div class="file-section">
                    <div class="file-header">
                        <h3>üìí Mayor Contable</h3>
                        <button class="btn-template" id="btnPlantillaMayor">üì• Descargar Plantilla</button>
                    </div>
                    <div class="file-drop-zone" id="dropZoneMayor">
                        <div class="upload-icon">üì§</div>
                        <div class="upload-text">Haz clic para seleccionar un archivo Excel</div>
                        <div class="upload-subtext">o arrastra tu archivo aqu√≠</div>
                        <input type="file" id="fileMayor" accept=".xlsx,.xls" style="display: none;">
                    </div>
                    <div id="previewMayor" class="file-preview hidden">
                        <span class="file-icon">‚úÖ</span>
                        <span id="fileNameMayor"></span>
                        <span class="record-count" id="recordCountMayor"></span>
                        <button class="btn-remove" id="btnRemoveMayor">‚úï</button>
                    </div>
                </div>
            </div>

            <!-- Paso 4: Selecci√≥n de tipo de conciliaci√≥n -->
            <div class="step hidden" id="step-tipo">
                <h2 class="step-title">
                    <span class="step-number">4</span>
                    ¬øQu√© desea conciliar?
                </h2>
                <div class="type-grid">
                    <button class="type-btn" data-tipo="creditos">
                        <div class="type-btn-icon">üí∞</div>
                        <div class="type-btn-title">Cr√©ditos</div>
                        <div class="type-btn-subtitle">Entradas de dinero (Haber del Mayor = Cr√©dito del Extracto)</div>
                    </button>
                    <button class="type-btn" data-tipo="debitos">
                        <div class="type-btn-icon">üí∏</div>
                        <div class="type-btn-title">D√©bitos</div>
                        <div class="type-btn-subtitle">Salidas de dinero (Debe del Mayor = D√©bito del Extracto)</div>
                    </button>
                </div>
            </div>

            <!-- Paso 5 (antes 2): Carga de archivos - Solo visible para carga manual de extracto -->
            <div class="step hidden" id="step-archivos">
                <h2 class="step-title">
                    <span class="step-number">5</span>
                    Cargar Extracto Bancario (opcional)
                </h2>

                <!-- Extracto Bancario -->
                <div class="file-section">
                    <div class="file-header">
                        <h3>üè¶ Extracto Bancario</h3>
                        <button class="btn-template" id="btnPlantillaExtracto">üì• Descargar Plantilla</button>
                    </div>

                    <!-- Opci√≥n: Cargar archivo Excel -->
                    <div id="extractoArchivoSection">
                        <div class="file-drop-zone" id="dropZoneExtracto">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">Haz clic para seleccionar un archivo Excel</div>
                            <div class="upload-subtext">o arrastra tu archivo aqu√≠ (reemplaza los extractos de auditor√≠a)</div>
                            <input type="file" id="fileExtracto" accept=".xlsx,.xls" style="display: none;">
                        </div>
                        <div id="previewExtracto" class="file-preview hidden">
                            <span class="file-icon">‚úÖ</span>
                            <span id="fileNameExtracto"></span>
                            <span class="record-count" id="recordCountExtracto"></span>
                            <button class="btn-remove" id="btnRemoveExtracto">‚úï</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paso 5: Configuraci√≥n de tolerancias -->
            <div class="step hidden" id="step-tolerancias">
                <h2 class="step-title">
                    <span class="step-number">5</span>
                    Configuraci√≥n de tolerancias
                </h2>
                <div class="tolerance-grid">
                    <div class="tolerance-item">
                        <label for="toleranciaFecha">Tolerancia de fechas (d√≠as)</label>
                        <input type="number" id="toleranciaFecha" value="0" min="0" max="365" class="input-number">
                        <span class="tolerance-hint">¬± d√≠as de diferencia permitida</span>
                    </div>
                    <div class="tolerance-item">
                        <label for="toleranciaImporte">Tolerancia de importes ($)</label>
                        <input type="number" id="toleranciaImporte" value="0" min="0" step="1000" class="input-number">
                        <span class="tolerance-hint">¬± diferencia permitida en pesos</span>
                    </div>
                    <div class="tolerance-item">
                        <label for="exigenciaPalabras">Palabras coincidentes (exigencia)</label>
                        <input type="number" id="exigenciaPalabras" value="2" min="0" max="10" class="input-number">
                        <span class="tolerance-hint">M√≠nimo palabras coincidentes entre leyenda y descripci√≥n (0 = sin exigencia)</span>
                    </div>
                </div>
                <div id="mensaje-sugerencia-proceso" class="mensaje-sugerencia">
                    <span class="sugerencia-icono">üí°</span>
                    <span class="sugerencia-texto">Proceso inicial: Par√°metros sugeridos para m√°xima precisi√≥n. Se recomienda comenzar con 0 d√≠as, $0 y 2 palabras de exigencia.</span>
                </div>
            </div>

            <!-- Paso 6: Ejecutar conciliaci√≥n -->
            <div class="step hidden" id="step-ejecutar">
                <h2 class="step-title">
                    <span class="step-number">6</span>
                    Ejecutar conciliaci√≥n
                </h2>
                <button id="btnConciliar" class="btn-conciliar">
                    üîç Conciliar Movimientos
                </button>
            </div>

            <!-- Mensajes de error y √©xito -->
            <div id="errorBox" class="message-box error-box hidden"></div>
            <div id="successBox" class="message-box success-box hidden"></div>

            <!-- Resultados -->
            <div id="resultados" class="results-section hidden">
                <div class="results-header">
                    <h2 class="results-title">üìä Resultados de Conciliaci√≥n</h2>
                    <div class="results-actions">
                        <button id="btnActualizarMayor" class="btn-secondary" onclick="mostrarModalActualizarMayor()">
                            üì§ Actualizar Mayor
                        </button>
                        <button id="btnGuardarConciliacion" class="btn-success" onclick="guardarConciliacion()">
                            üíæ Guardar Conciliaci√≥n
                        </button>
                        <button id="btnNuevaConciliacion" class="btn-primary">
                            üîÑ Nueva Conciliaci√≥n
                        </button>
                    </div>

                    <!-- Modal para actualizar mayor -->
                    <div id="modalActualizarMayor" class="modal-overlay hidden">
                        <div class="modal-content modal-actualizar-mayor">
                            <div class="modal-header">
                                <h3>üì§ Actualizar Mayor Contable</h3>
                                <button class="btn-cerrar-modal" onclick="cerrarModalActualizarMayor()">‚úï</button>
                            </div>
                            <div class="modal-body">
                                <p class="modal-descripcion">
                                    Sube un nuevo archivo de Mayor Contable. La herramienta detectar√°
                                    autom√°ticamente los movimientos nuevos bas√°ndose en el n√∫mero de asiento.
                                </p>
                                <div class="file-drop-zone" id="dropZoneActualizarMayor">
                                    <div class="upload-icon">üì§</div>
                                    <div class="upload-text">Haz clic para seleccionar el archivo</div>
                                    <div class="upload-subtext">o arrastra tu archivo aqu√≠</div>
                                    <input type="file" id="fileActualizarMayor" accept=".xlsx,.xls" style="display: none;">
                                </div>
                                <div id="previewActualizarMayor" class="actualizar-mayor-preview hidden">
                                    <div class="preview-stats">
                                        <div class="stat-item">
                                            <span class="stat-label">Total movimientos en archivo:</span>
                                            <span class="stat-value" id="totalMovimientosArchivo">0</span>
                                        </div>
                                        <div class="stat-item stat-success">
                                            <span class="stat-label">Movimientos nuevos a agregar:</span>
                                            <span class="stat-value" id="movimientosNuevos">0</span>
                                        </div>
                                        <div class="stat-item stat-warning">
                                            <span class="stat-label">Movimientos ya existentes:</span>
                                            <span class="stat-value" id="movimientosExistentes">0</span>
                                        </div>
                                    </div>
                                    <button id="btnConfirmarActualizarMayor" class="btn-primary btn-confirmar-actualizar" onclick="confirmarActualizarMayor()">
                                        ‚úÖ Agregar movimientos nuevos
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resumen -->
                <div class="results-summary">
                    <div class="summary-card success">
                        <div class="summary-icon">‚úÖ</div>
                        <div class="summary-values-dual">
                            <div class="dual-value">
                                <span class="dual-number" id="conciliadosMayorCount">0</span>
                                <span class="dual-label">Mayor</span>
                            </div>
                            <div class="dual-separator">|</div>
                            <div class="dual-value">
                                <span class="dual-number" id="conciliadosExtractoCount">0</span>
                                <span class="dual-label">Extracto</span>
                            </div>
                        </div>
                        <div class="summary-label">Movimientos conciliados</div>
                    </div>
                    <div class="summary-card warning">
                        <div class="summary-icon">‚ùå</div>
                        <div class="summary-value" id="mayorNoConciliado">0</div>
                        <div class="summary-label">Mayor sin conciliar</div>
                    </div>
                    <div class="summary-card warning">
                        <div class="summary-icon">‚ùå</div>
                        <div class="summary-value" id="extractoNoConciliado">0</div>
                        <div class="summary-label">Extracto sin conciliar</div>
                    </div>
                </div>

                <!-- Totales -->
                <div class="totals-box">
                    <div class="total-row">
                        <span class="total-label">Total Mayor:</span>
                        <span class="total-value" id="totalMayor">$0,00</span>
                    </div>
                    <div class="total-row">
                        <span class="total-label">Total Extracto:</span>
                        <span class="total-value" id="totalExtracto">$0,00</span>
                    </div>
                    <div class="total-row diferencia">
                        <span class="total-label">Diferencia:</span>
                        <span class="total-value" id="diferencia">$0,00</span>
                    </div>
                    <div class="total-row eliminados-row hidden" id="eliminadosResumen">
                        <span class="total-label">Eliminados del Mayor:</span>
                        <span class="total-value eliminados-value" id="totalEliminados">0 movimientos ($0,00)</span>
                    </div>
                    <div class="total-row diferencia-ajustada hidden" id="diferenciaAjustadaRow">
                        <span class="total-label">Diferencia ajustada:</span>
                        <span class="total-value" id="diferenciaAjustada">$0,00</span>
                    </div>
                </div>

                <!-- Panel de Reprocesamiento -->
                <div id="panel-reproceso" class="panel-reproceso hidden">
                    <div class="panel-reproceso-header">
                        <h3>üîÑ Reprocesar Movimientos Pendientes</h3>
                        <button class="btn-toggle-reproceso" id="btnToggleReproceso" onclick="togglePanelReproceso()">‚ñº</button>
                    </div>
                    <div class="panel-reproceso-body" id="panelReprocesoBody">
                        <div class="reproceso-info">
                            <span class="reproceso-pendientes">
                                Movimientos pendientes: <strong>Mayor (<span id="reprocesoPendientesMayor">0</span>)</strong> | <strong>Extracto (<span id="reprocesoPendientesExtracto">0</span>)</strong>
                            </span>
                        </div>
                        <div class="reproceso-tolerancias">
                            <div class="reproceso-campo">
                                <label for="reproceso-tolerancia-fecha">Tolerancia de fechas:</label>
                                <div class="reproceso-input-wrapper">
                                    <input type="number" id="reproceso-tolerancia-fecha" value="0" min="0" max="365" class="reproceso-input">
                                    <span class="reproceso-unidad">d√≠as</span>
                                </div>
                            </div>
                            <div class="reproceso-campo">
                                <label for="reproceso-tolerancia-importe">Tolerancia de importes:</label>
                                <div class="reproceso-input-wrapper">
                                    <span class="reproceso-signo">$</span>
                                    <input type="number" id="reproceso-tolerancia-importe" value="0" min="0" step="100" class="reproceso-input">
                                </div>
                            </div>
                            <div class="reproceso-campo">
                                <label for="reproceso-exigencia-palabras">Palabras coincidentes:</label>
                                <div class="reproceso-input-wrapper">
                                    <input type="number" id="reproceso-exigencia-palabras" value="1" min="0" max="10" class="reproceso-input">
                                    <span class="reproceso-unidad">palabras</span>
                                </div>
                            </div>
                        </div>
                        <div id="mensaje-sugerencia-reproceso" class="mensaje-sugerencia mensaje-sugerencia-reproceso">
                            <span class="sugerencia-icono">üí°</span>
                            <span class="sugerencia-texto">Reproceso 1: Par√°metros sugeridos (0 d√≠as, $0, 1 palabra). Reducir exigencia de palabras gradualmente.</span>
                        </div>
                        <div class="reproceso-advertencia">
                            <span class="advertencia-icono">‚ö†Ô∏è</span>
                            <span>Solo se procesar√°n los movimientos NO conciliados. Los movimientos ya conciliados no ser√°n afectados.</span>
                        </div>
                        <!-- Info de desconciliaciones manuales -->
                        <div id="desconciliaciones-info" class="desconciliaciones-info hidden">
                            <span class="desconciliaciones-icono">üö´</span>
                            <span class="desconciliaciones-texto">
                                <span id="countDesconciliaciones">0</span> par(es) de movimientos excluidos de conciliaci√≥n autom√°tica
                            </span>
                            <button id="btnLimpiarDesconciliaciones" class="btn-limpiar-desconciliaciones" onclick="limpiarDesconciliacionesManuales()" title="Permitir que estos movimientos se vuelvan a conciliar">
                                üóëÔ∏è Limpiar
                            </button>
                        </div>
                        <div class="reproceso-acciones">
                            <button id="btnReprocesar" class="btn-reprocesar" onclick="reprocesarPendientes()">
                                üîÑ Reprocesar Pendientes
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Historial de Procesamiento -->
                <div id="historial-procesamiento" class="historial-procesamiento hidden">
                    <div class="historial-header">
                        <h4>üìã Historial de Procesamiento</h4>
                        <button class="btn-toggle-historial" id="btnToggleHistorial" onclick="toggleHistorial()">Ocultar</button>
                    </div>
                    <div class="historial-body" id="historialBody">
                        <div class="historial-lista" id="historialLista">
                            <!-- Se llena din√°micamente -->
                        </div>
                        <div class="historial-total">
                            Total conciliados: <strong id="historialTotalConciliados">0</strong>
                        </div>
                    </div>
                </div>

                <!-- Tabs para ver detalles -->
                <div class="tabs">
                    <button class="tab-btn active" data-tab="conciliados">Conciliados</button>
                    <button class="tab-btn" data-tab="mayor-pendiente">Mayor Pendiente</button>
                    <button class="tab-btn" data-tab="extracto-pendiente">Extracto Pendiente</button>
                    <button class="tab-btn tab-auditoria" data-tab="en-auditoria">En Auditor√≠a <span id="countEnAuditoria">(0)</span></button>
                    <button class="tab-btn tab-extracto-excluido" data-tab="extracto-excluido">Extracto Excluido <span id="countExtractoExcluido">(0)</span></button>
                    <button class="tab-btn" data-tab="eliminados">Eliminados <span id="countEliminados">(0)</span></button>
                </div>

                <!-- Tabla de conciliados -->
                <div class="tab-content active" id="tab-conciliados">
                    <div class="panel-header-pendiente">
                        <h3>Conciliados <span id="countConciliadosTab">(0)</span></h3>
                        <div class="header-actions">
                            <button id="btnToggleVerdes" class="btn-toggle-grupo btn-toggle-verdes" onmousedown="preVerificarToggleGrupo(event)" onclick="toggleGrupoVerdes(event)">
                                üü¢ Ocultar verdes
                            </button>
                            <button id="btnToggleNaranjas" class="btn-toggle-grupo btn-toggle-naranjas" onmousedown="preVerificarToggleGrupo(event)" onclick="toggleGrupoNaranjas(event)">
                                üü† Ocultar naranjas
                            </button>
                            <button id="btnCambiarColorMasivo" class="btn-cambiar-color-masivo hidden" onclick="mostrarMenuCambioColorMasivo()">
                                üé® Cambiar color (<span id="countConciliadosSeleccionados">0</span>)
                            </button>
                        </div>
                    </div>

                    <!-- ========== SECCI√ìN VERDES (con coincidencia) ========== -->
                    <div id="seccion-conciliados-verdes" class="seccion-grupo-conciliados seccion-verdes">
                        <div class="grupo-header grupo-header-verdes">
                            <h4>üü¢ Con coincidencia de descripci√≥n <span id="countVerdesFiltrados">(0)</span></h4>
                            <button class="btn-filtros btn-filtros-grupo" id="btnFiltrosVerdes" onclick="toggleFiltrosGrupo('verdes')">
                                üîç Filtros ‚ñº
                            </button>
                        </div>

                        <!-- Panel de filtros Verdes -->
                        <div id="filtros-conciliados-verdes" class="filtros-panel filtros-panel-grupo hidden">
                            <div class="filtros-grid-compacto">
                                <div class="filtros-fila">
                                    <div class="filtro-grupo">
                                        <label>Tipo:</label>
                                        <select id="filtroVerdesTipoConciliacion" class="filtro-select">
                                            <option value="">Todos</option>
                                            <option value="1:1">1 a 1</option>
                                            <option value="multiple">1 a N / N a 1</option>
                                        </select>
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Fecha Mayor desde:</label>
                                        <input type="date" id="filtroVerdesMayorFechaDesde" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Fecha Mayor hasta:</label>
                                        <input type="date" id="filtroVerdesMayorFechaHasta" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>N¬∫ Asiento:</label>
                                        <input type="text" id="filtroVerdesNumeroAsiento" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Leyenda:</label>
                                        <input type="text" id="filtroVerdesLeyenda" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                </div>
                                <div class="filtros-fila">
                                    <div class="filtro-grupo">
                                        <label>Fecha Extracto desde:</label>
                                        <input type="date" id="filtroVerdesExtractoFechaDesde" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Fecha Extracto hasta:</label>
                                        <input type="date" id="filtroVerdesExtractoFechaHasta" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Origen:</label>
                                        <input type="text" id="filtroVerdesOrigen" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Descripci√≥n:</label>
                                        <input type="text" id="filtroVerdesDescripcion" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                    <div class="filtro-grupo filtro-importe-compacto">
                                        <label>Importe:</label>
                                        <div class="filtro-importe-wrapper">
                                            <select id="filtroVerdesImporteTipo" class="filtro-select filtro-select-sm" onchange="toggleSegundoImporteGrupo('verdes')">
                                                <option value="">--</option>
                                                <option value="mayor">></option>
                                                <option value="menor"><</option>
                                                <option value="igual">=</option>
                                                <option value="entre">Entre</option>
                                            </select>
                                            <input type="number" id="filtroVerdesImporteValor" class="filtro-input filtro-numero-sm" placeholder="$" step="0.01">
                                            <input type="number" id="filtroVerdesImporteValor2" class="filtro-input filtro-numero-sm hidden" placeholder="$" step="0.01">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filtros-acciones filtros-acciones-compactas">
                                <button class="btn-aplicar-filtro btn-sm" onclick="aplicarFiltrosVerdes()">Aplicar</button>
                                <button class="btn-limpiar-filtro btn-sm" onclick="limpiarFiltrosVerdes()">Limpiar</button>
                            </div>
                        </div>

                        <div class="table-wrapper">
                            <table class="results-table table-selectable">
                                <thead>
                                    <tr>
                                        <th class="col-checkbox" rowspan="2"><input type="checkbox" id="selectAllConciliadosVerdes" title="Seleccionar todos" onchange="seleccionarTodosConciliadosGrupo('verdes', this.checked)"></th>
                                        <th colspan="4" class="header-group mayor">MAYOR CONTABLE</th>
                                        <th class="separator"></th>
                                        <th colspan="4" class="header-group extracto">EXTRACTO BANCARIO</th>
                                        <th class="header-diff">Dif.</th>
                                        <th class="header-action">Acci√≥n</th>
                                    </tr>
                                    <tr>
                                        <th class="col-fecha">Fecha</th>
                                        <th class="col-numero">N¬∫</th>
                                        <th class="col-leyenda">Leyenda</th>
                                        <th class="col-importe">Importe</th>
                                        <th class="separator"></th>
                                        <th class="col-fecha">Fecha</th>
                                        <th class="col-descripcion">Descripci√≥n</th>
                                        <th class="col-origen">Origen</th>
                                        <th class="col-importe">Importe</th>
                                        <th class="col-diferencia">$</th>
                                        <th class="header-action">Acci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaConciliadosVerdes"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- ========== SECCI√ìN NARANJAS (sin coincidencia) ========== -->
                    <div id="seccion-conciliados-naranjas" class="seccion-grupo-conciliados seccion-naranjas">
                        <div class="grupo-header grupo-header-naranjas">
                            <h4>üü† Sin coincidencia de descripci√≥n <span id="countNaranjasFiltrados">(0)</span></h4>
                            <button class="btn-filtros btn-filtros-grupo" id="btnFiltrosNaranjas" onclick="toggleFiltrosGrupo('naranjas')">
                                üîç Filtros ‚ñº
                            </button>
                        </div>

                        <!-- Panel de filtros Naranjas -->
                        <div id="filtros-conciliados-naranjas" class="filtros-panel filtros-panel-grupo hidden">
                            <div class="filtros-grid-compacto">
                                <div class="filtros-fila">
                                    <div class="filtro-grupo">
                                        <label>Tipo:</label>
                                        <select id="filtroNaranjasTipoConciliacion" class="filtro-select">
                                            <option value="">Todos</option>
                                            <option value="1:1">1 a 1</option>
                                            <option value="multiple">1 a N / N a 1</option>
                                        </select>
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Fecha Mayor desde:</label>
                                        <input type="date" id="filtroNaranjasMayorFechaDesde" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Fecha Mayor hasta:</label>
                                        <input type="date" id="filtroNaranjasMayorFechaHasta" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>N¬∫ Asiento:</label>
                                        <input type="text" id="filtroNaranjasNumeroAsiento" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Leyenda:</label>
                                        <input type="text" id="filtroNaranjasLeyenda" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                </div>
                                <div class="filtros-fila">
                                    <div class="filtro-grupo">
                                        <label>Fecha Extracto desde:</label>
                                        <input type="date" id="filtroNaranjasExtractoFechaDesde" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Fecha Extracto hasta:</label>
                                        <input type="date" id="filtroNaranjasExtractoFechaHasta" class="filtro-input">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Origen:</label>
                                        <input type="text" id="filtroNaranjasOrigen" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                    <div class="filtro-grupo">
                                        <label>Descripci√≥n:</label>
                                        <input type="text" id="filtroNaranjasDescripcion" class="filtro-input" placeholder="Buscar...">
                                    </div>
                                    <div class="filtro-grupo filtro-importe-compacto">
                                        <label>Importe:</label>
                                        <div class="filtro-importe-wrapper">
                                            <select id="filtroNaranjasImporteTipo" class="filtro-select filtro-select-sm" onchange="toggleSegundoImporteGrupo('naranjas')">
                                                <option value="">--</option>
                                                <option value="mayor">></option>
                                                <option value="menor"><</option>
                                                <option value="igual">=</option>
                                                <option value="entre">Entre</option>
                                            </select>
                                            <input type="number" id="filtroNaranjasImporteValor" class="filtro-input filtro-numero-sm" placeholder="$" step="0.01">
                                            <input type="number" id="filtroNaranjasImporteValor2" class="filtro-input filtro-numero-sm hidden" placeholder="$" step="0.01">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filtros-acciones filtros-acciones-compactas">
                                <button class="btn-aplicar-filtro btn-sm" onclick="aplicarFiltrosNaranjas()">Aplicar</button>
                                <button class="btn-limpiar-filtro btn-sm" onclick="limpiarFiltrosNaranjas()">Limpiar</button>
                            </div>
                        </div>

                        <div class="table-wrapper">
                            <table class="results-table table-selectable">
                                <thead>
                                    <tr>
                                        <th class="col-checkbox" rowspan="2"><input type="checkbox" id="selectAllConciliadosNaranjas" title="Seleccionar todos" onchange="seleccionarTodosConciliadosGrupo('naranjas', this.checked)"></th>
                                        <th colspan="4" class="header-group mayor">MAYOR CONTABLE</th>
                                        <th class="separator"></th>
                                        <th colspan="4" class="header-group extracto">EXTRACTO BANCARIO</th>
                                        <th class="header-diff">Dif.</th>
                                        <th class="header-action">Acci√≥n</th>
                                    </tr>
                                    <tr>
                                        <th class="col-fecha">Fecha</th>
                                        <th class="col-numero">N¬∫</th>
                                        <th class="col-leyenda">Leyenda</th>
                                        <th class="col-importe">Importe</th>
                                        <th class="separator"></th>
                                        <th class="col-fecha">Fecha</th>
                                        <th class="col-descripcion">Descripci√≥n</th>
                                        <th class="col-origen">Origen</th>
                                        <th class="col-importe">Importe</th>
                                        <th class="col-diferencia">$</th>
                                        <th class="header-action">Acci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaConciliadosNaranjas"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Overlay y Menu de cambio de color masivo -->
                    <div id="overlayCambioColor" class="overlay-cambio-color hidden" onclick="cerrarMenuCambioColorMasivo()"></div>
                    <div id="menuCambioColorMasivo" class="menu-cambio-color hidden">
                        <div class="menu-cambio-color-header">
                            <span>Cambiar color de <strong id="menuCambioColorCount">0</strong> conciliaciones</span>
                            <button class="btn-cerrar-menu" onclick="cerrarMenuCambioColorMasivo()">‚úï</button>
                        </div>
                        <div class="menu-cambio-color-opciones">
                            <button class="btn-color-opcion btn-color-verde" onclick="cambiarColorMasivo(true)">
                                üü¢ Marcar como verde (con coincidencia)
                            </button>
                            <button class="btn-color-opcion btn-color-naranja" onclick="cambiarColorMasivo(false)">
                                üü† Marcar como naranja (sin coincidencia)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabla Mayor Pendiente -->
                <div class="tab-content" id="tab-mayor-pendiente">
                    <div class="panel-header-pendiente">
                        <h3>Mayor Pendiente <span id="countMayorPendiente">(0)</span></h3>
                        <div class="header-actions">
                            <button id="btnEliminarSeleccionados" class="btn-eliminar-seleccionados hidden" onclick="mostrarModalEliminar('seleccionados')">
                                üóëÔ∏è Eliminar seleccionados (0)
                            </button>
                            <button class="btn-filtros" id="btnFiltrosMayor" onclick="toggleFiltros('mayor')">
                                üîç Filtros ‚ñº
                            </button>
                        </div>
                    </div>

                    <!-- Panel de filtros Mayor -->
                    <div id="filtros-mayor" class="filtros-panel hidden">
                        <div class="filtros-grid">
                            <div class="filtro-grupo">
                                <label>Fecha desde:</label>
                                <input type="date" id="filtroMayorFechaDesde" class="filtro-input">
                            </div>
                            <div class="filtro-grupo">
                                <label>Fecha hasta:</label>
                                <input type="date" id="filtroMayorFechaHasta" class="filtro-input">
                            </div>
                            <div class="filtro-grupo filtro-importe">
                                <label>Importe:</label>
                                <div class="filtro-importe-wrapper">
                                    <select id="filtroMayorImporteTipo" class="filtro-select" onchange="toggleSegundoImporte('mayor')">
                                        <option value="">-- Seleccionar --</option>
                                        <option value="mayor">Mayor que</option>
                                        <option value="menor">Menor que</option>
                                        <option value="igual">Igual a</option>
                                        <option value="entre">Entre</option>
                                    </select>
                                    <input type="number" id="filtroMayorImporteValor" class="filtro-input filtro-numero" placeholder="Monto" step="0.01">
                                    <input type="number" id="filtroMayorImporteValor2" class="filtro-input filtro-numero hidden" placeholder="Monto m√°x" step="0.01">
                                </div>
                            </div>
                            <div class="filtro-grupo">
                                <label>N¬∫ Asiento:</label>
                                <input type="text" id="filtroMayorNumeroAsiento" class="filtro-input" placeholder="Buscar...">
                            </div>
                            <div class="filtro-grupo filtro-ancho">
                                <label>Leyenda:</label>
                                <input type="text" id="filtroMayorLeyenda" class="filtro-input" placeholder="Buscar en leyenda...">
                            </div>
                            <div class="filtro-grupo">
                                <label>C/E:</label>
                                <select id="filtroMayorCE" class="filtro-select">
                                    <option value="todos">Todos</option>
                                    <option value="C">C</option>
                                    <option value="E">E</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>Tipo:</label>
                                <select id="filtroMayorTipo" class="filtro-select">
                                    <option value="todos">Todos</option>
                                </select>
                            </div>
                        </div>
                        <div class="filtros-acciones">
                            <button class="btn-aplicar-filtro" onclick="aplicarFiltrosMayor()">Aplicar Filtros</button>
                            <button class="btn-limpiar-filtro" onclick="limpiarFiltrosMayor()">Limpiar</button>
                        </div>
                    </div>

                    <!-- Contador de resultados filtrados -->
                    <div id="filtrosMayorResultado" class="filtros-resultado hidden">
                        Mostrando <span id="filtrosMayorMostrados">0</span> de <span id="filtrosMayorTotal">0</span> movimientos
                    </div>

                    <!-- Badges de filtros activos -->
                    <div id="filtrosMayorActivos" class="filtros-activos hidden"></div>

                    <div class="table-wrapper">
                        <table class="results-table table-selectable">
                            <thead>
                                <tr>
                                    <th class="col-checkbox"><input type="checkbox" id="selectAllMayor" title="Seleccionar todos"></th>
                                    <th class="columna-ordenable" data-columna="fecha" onclick="ordenarPorColumna('mayor', 'fecha')">
                                        Fecha <span class="icono-orden">‚ñº</span>
                                    </th>
                                    <th class="columna-ordenable" data-columna="numeroAsiento" onclick="ordenarPorColumna('mayor', 'numeroAsiento')">
                                        N¬∫ Asiento <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable" data-columna="ce" onclick="ordenarPorColumna('mayor', 'ce')">
                                        C/E <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable" data-columna="tipo" onclick="ordenarPorColumna('mayor', 'tipo')">
                                        Tipo <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable" data-columna="leyenda" onclick="ordenarPorColumna('mayor', 'leyenda')">
                                        Leyenda <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable text-right" data-columna="debe" onclick="ordenarPorColumna('mayor', 'debe')">
                                        Debe <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable text-right" data-columna="haber" onclick="ordenarPorColumna('mayor', 'haber')">
                                        Haber <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="header-action-eliminar">Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="tablaMayorPendiente"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabla Eliminados -->
                <div class="tab-content" id="tab-eliminados">
                    <div class="eliminados-header">
                        <h3>Movimientos Eliminados <span id="countEliminadosTab">(0)</span></h3>
                    </div>
                    <div class="eliminados-info">
                        <p>Estos movimientos fueron excluidos del proceso de conciliaci√≥n.</p>
                    </div>
                    <div class="table-wrapper">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>N¬∫ Asiento</th>
                                    <th>C/E</th>
                                    <th>Tipo</th>
                                    <th>Leyenda</th>
                                    <th class="text-right">Importe</th>
                                    <th>Fecha Eliminaci√≥n</th>
                                    <th>Motivo</th>
                                    <th class="header-action">Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="tablaEliminados">
                                <tr><td colspan="9" class="text-muted" style="text-align:center;padding:20px;">No hay movimientos eliminados</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabla Extracto Pendiente -->
                <div class="tab-content" id="tab-extracto-pendiente">
                    <div class="panel-header-pendiente">
                        <h3>Extracto Pendiente <span id="countExtractoPendiente">(0)</span></h3>
                        <div class="header-actions">
                            <button id="btnExcluirExtractoSeleccionados" class="btn-excluir-extracto hidden" onclick="excluirExtractoSeleccionados()">
                                üö´ Excluir del an√°lisis (0)
                            </button>
                            <button id="btnMoverAuditoriaSeleccionados" class="btn-mover-auditoria hidden" onclick="moverSeleccionadosAAuditoria()">
                                üîç Marcar para auditor√≠a (0)
                            </button>
                            <button class="btn-filtros" id="btnFiltrosExtracto" onclick="toggleFiltros('extracto')">
                                üîç Filtros ‚ñº
                            </button>
                        </div>
                    </div>

                    <!-- Panel de filtros Extracto -->
                    <div id="filtros-extracto" class="filtros-panel hidden">
                        <div class="filtros-grid">
                            <div class="filtro-grupo">
                                <label>Fecha desde:</label>
                                <input type="date" id="filtroExtractoFechaDesde" class="filtro-input">
                            </div>
                            <div class="filtro-grupo">
                                <label>Fecha hasta:</label>
                                <input type="date" id="filtroExtractoFechaHasta" class="filtro-input">
                            </div>
                            <div class="filtro-grupo filtro-importe">
                                <label>Importe:</label>
                                <div class="filtro-importe-wrapper">
                                    <select id="filtroExtractoImporteTipo" class="filtro-select" onchange="toggleSegundoImporte('extracto')">
                                        <option value="">-- Seleccionar --</option>
                                        <option value="mayor">Mayor que</option>
                                        <option value="menor">Menor que</option>
                                        <option value="igual">Igual a</option>
                                        <option value="entre">Entre</option>
                                    </select>
                                    <input type="number" id="filtroExtractoImporteValor" class="filtro-input filtro-numero" placeholder="Monto" step="0.01">
                                    <input type="number" id="filtroExtractoImporteValor2" class="filtro-input filtro-numero hidden" placeholder="Monto m√°x" step="0.01">
                                </div>
                            </div>
                            <div class="filtro-grupo">
                                <label>Origen:</label>
                                <input type="text" id="filtroExtractoOrigen" class="filtro-input" placeholder="Buscar...">
                            </div>
                            <div class="filtro-grupo filtro-ancho">
                                <label>Descripci√≥n:</label>
                                <input type="text" id="filtroExtractoDescripcion" class="filtro-input" placeholder="Buscar en descripci√≥n...">
                            </div>
                        </div>
                        <div class="filtros-acciones">
                            <button class="btn-aplicar-filtro" onclick="aplicarFiltrosExtracto()">Aplicar Filtros</button>
                            <button class="btn-limpiar-filtro" onclick="limpiarFiltrosExtracto()">Limpiar</button>
                        </div>
                    </div>

                    <!-- Contador de resultados filtrados -->
                    <div id="filtrosExtractoResultado" class="filtros-resultado hidden">
                        Mostrando <span id="filtrosExtractoMostrados">0</span> de <span id="filtrosExtractoTotal">0</span> movimientos
                    </div>

                    <!-- Badges de filtros activos -->
                    <div id="filtrosExtractoActivos" class="filtros-activos hidden"></div>

                    <div class="table-wrapper">
                        <table class="results-table table-selectable">
                            <thead>
                                <tr>
                                    <th class="col-checkbox"><input type="checkbox" id="selectAllExtracto" title="Seleccionar todos"></th>
                                    <th class="columna-ordenable" data-columna="fecha" onclick="ordenarPorColumna('extracto', 'fecha')">
                                        Fecha <span class="icono-orden">‚ñº</span>
                                    </th>
                                    <th class="columna-ordenable" data-columna="descripcion" onclick="ordenarPorColumna('extracto', 'descripcion')">
                                        Descripci√≥n <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable" data-columna="origen" onclick="ordenarPorColumna('extracto', 'origen')">
                                        Origen <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable text-right" data-columna="debito" onclick="ordenarPorColumna('extracto', 'debito')">
                                        D√©bito <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="columna-ordenable text-right" data-columna="credito" onclick="ordenarPorColumna('extracto', 'credito')">
                                        Cr√©dito <span class="icono-orden">‚Üï</span>
                                    </th>
                                    <th class="header-action col-action-auditoria">Auditor√≠a</th>
                                </tr>
                            </thead>
                            <tbody id="tablaExtractoPendiente"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabla En Auditor√≠a -->
                <div class="tab-content" id="tab-en-auditoria">
                    <div class="auditoria-header">
                        <h3>Movimientos En Auditor√≠a <span id="countEnAuditoriaTab">(0)</span></h3>
                        <button id="btnExportarAuditoria" class="btn-exportar-auditoria" onclick="exportarAuditoriaExcel()" title="Exportar operaciones en auditor√≠a a Excel">
                            üì• Exportar a Excel
                        </button>
                    </div>
                    <div class="auditoria-info">
                        <p>Movimientos del extracto marcados para revisi√≥n. Estos movimientos no tienen registro en el Mayor y requieren an√°lisis especial.</p>
                    </div>
                    <div class="table-wrapper">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Descripci√≥n</th>
                                    <th>Origen</th>
                                    <th class="text-right">D√©bito</th>
                                    <th class="text-right">Cr√©dito</th>
                                    <th>Fecha Marcaci√≥n</th>
                                    <th class="col-nota-auditoria">Nota de Auditor√≠a</th>
                                    <th class="header-action">Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="tablaEnAuditoria">
                                <tr><td colspan="8" class="text-muted" style="text-align:center;padding:20px;">No hay movimientos en auditor√≠a</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tabla Extracto Excluido -->
                <div class="tab-content" id="tab-extracto-excluido">
                    <div class="extracto-excluido-header">
                        <h3>Movimientos del Extracto Excluidos <span id="countExtractoExcluidoTab">(0)</span></h3>
                        <div class="header-actions">
                            <button id="btnRestaurarTodosExcluidos" class="btn-restaurar-todos hidden" onclick="restaurarTodosExtractoExcluidos()">
                                ‚Ü©Ô∏è Restaurar todos
                            </button>
                            <button id="btnRestaurarExcluidosSeleccionados" class="btn-restaurar-seleccionados hidden" onclick="restaurarExtractoExcluidosSeleccionados()">
                                ‚Ü©Ô∏è Restaurar seleccionados (0)
                            </button>
                        </div>
                    </div>
                    <div class="extracto-excluido-info">
                        <p>Estos movimientos del extracto bancario fueron excluidos del proceso de conciliaci√≥n. Puede restaurarlos individualmente o de forma masiva.</p>
                    </div>
                    <div class="table-wrapper">
                        <table class="results-table table-selectable">
                            <thead>
                                <tr>
                                    <th class="col-checkbox"><input type="checkbox" id="selectAllExtractoExcluido" title="Seleccionar todos" onchange="seleccionarTodosExtractoExcluido(this.checked)"></th>
                                    <th>Fecha</th>
                                    <th>Descripci√≥n</th>
                                    <th>Origen</th>
                                    <th class="text-right">D√©bito</th>
                                    <th class="text-right">Cr√©dito</th>
                                    <th>Fecha Exclusi√≥n</th>
                                    <th class="header-action">Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="tablaExtractoExcluido">
                                <tr><td colspan="8" class="text-muted" style="text-align:center;padding:20px;">No hay movimientos excluidos del extracto</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Barra de selecci√≥n flotante para conciliaci√≥n manual -->
                <div id="selectionBar" class="selection-bar hidden">
                    <div class="selection-summary">
                        <div class="selection-group">
                            <span class="selection-label">Mayor:</span>
                            <span id="selMayorCount" class="selection-count">0</span>
                            <span class="selection-amount">(<span id="selMayorTotal">$0,00</span>)</span>
                        </div>
                        <div class="selection-separator">|</div>
                        <div class="selection-group">
                            <span class="selection-label">Extracto:</span>
                            <span id="selExtractoCount" class="selection-count">0</span>
                            <span class="selection-amount">(<span id="selExtractoTotal">$0,00</span>)</span>
                        </div>
                        <div class="selection-separator">|</div>
                        <div class="selection-group selection-diff">
                            <span class="selection-label">Diferencia:</span>
                            <span id="selDiferencia" class="selection-diff-value">$0,00</span>
                        </div>
                    </div>
                    <div class="selection-actions">
                        <button id="btnLimpiarSeleccion" class="btn-selection-clear" title="Limpiar selecci√≥n">‚úï Limpiar</button>
                        <button id="btnVincular" class="btn-vincular" disabled>üîó Vincular como Conciliados</button>
                    </div>
                </div>

                <!-- Bot√≥n de descarga -->
                <button id="btnDescargar" class="btn-download">
                    üì• Descargar Reporte Excel
                </button>
            </div>

        </div>
    </div>

    <!-- Modal de progreso -->
    <div id="overlay-progreso" class="overlay-progreso"></div>
    <div id="modal-progreso" class="modal-progreso">
        <h3>Procesando Conciliaci√≥n</h3>
        <div class="barra-contenedor">
            <div id="barra-progreso" class="barra-progreso"></div>
        </div>
        <div id="porcentaje-progreso" class="porcentaje-progreso">0%</div>
        <div id="paso-progreso" class="paso-progreso">Paso 1 de 4</div>
        <div id="mensaje-progreso" class="mensaje-progreso">Iniciando...</div>
        <div id="contador-progreso" class="contador-progreso"></div>
        <div id="conciliados-progreso" class="conciliados-progreso"></div>
    </div>

    <!-- Modal de conciliaciones guardadas - Selecci√≥n -->
    <div id="overlay-conciliacion-guardada" class="overlay-eliminar"></div>
    <div id="modal-conciliacion-guardada" class="modal-eliminar modal-gestion-conciliaciones" style="max-width: 600px;">
        <div class="modal-eliminar-header">
            <h3>üìÇ Conciliaciones Guardadas</h3>
            <button class="modal-close-btn" onclick="cerrarModalConciliacionGuardada()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">Se encontraron conciliaciones guardadas para esta cuenta. Seleccione una para cargar:</p>

            <div id="conciliaciones-seleccion-lista" class="conciliaciones-seleccion-lista">
                <!-- Lista din√°mica de conciliaciones -->
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">üí°</span>
                <span>Al cargar una conciliaci√≥n, se restaurar√°n todos los movimientos conciliados y pendientes.</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarModalConciliacionGuardada()">Nueva Conciliaci√≥n</button>
            <button id="btnConfirmarCargarConciliacion" class="btn-confirmar-eliminar" style="background: #28a745;" onclick="confirmarCargarConciliacionSeleccionada()" disabled>üìÇ Cargar Seleccionada</button>
        </div>
    </div>

    <!-- Modal de gesti√≥n de conciliaciones -->
    <div id="overlay-gestion-conciliaciones" class="overlay-eliminar"></div>
    <div id="modal-gestion-conciliaciones" class="modal-eliminar modal-gestion-conciliaciones">
        <div class="modal-eliminar-header">
            <h3>üìã Gesti√≥n de Conciliaciones Guardadas</h3>
            <button class="modal-close-btn" onclick="cerrarGestionConciliaciones()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">Administre las conciliaciones guardadas para este cliente y cuenta:</p>

            <div id="gestion-conciliaciones-lista" class="conciliaciones-lista">
                <!-- Lista din√°mica de conciliaciones -->
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarGestionConciliaciones()">Cerrar</button>
        </div>
    </div>

    <!-- Modal de confirmar eliminaci√≥n de conciliaci√≥n -->
    <div id="overlay-confirmar-eliminar-conciliacion" class="overlay-eliminar"></div>
    <div id="modal-confirmar-eliminar-conciliacion" class="modal-eliminar" style="max-width: 450px;">
        <div class="modal-eliminar-header">
            <h3>üóëÔ∏è Eliminar Conciliaci√≥n</h3>
            <button class="modal-close-btn" onclick="cerrarConfirmarEliminarConciliacion()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">¬øEst√° seguro de eliminar esta conciliaci√≥n guardada?</p>

            <div id="eliminar-conciliacion-detalles" class="eliminar-detalles">
                <!-- Detalles din√°micos -->
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">‚ö†Ô∏è</span>
                <span>Esta acci√≥n no se puede deshacer. Se perder√°n todos los datos de la conciliaci√≥n.</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarConfirmarEliminarConciliacion()">Cancelar</button>
            <button class="btn-confirmar-eliminar" onclick="ejecutarEliminarConciliacion()">üóëÔ∏è Eliminar</button>
        </div>
    </div>

    <!-- Modal de confirmar eliminaci√≥n de conciliaci√≥n cargada -->
    <div id="overlay-confirmar-eliminar-cargada" class="overlay-eliminar"></div>
    <div id="modal-confirmar-eliminar-cargada" class="modal-eliminar" style="max-width: 450px;">
        <div class="modal-eliminar-header">
            <h3>üóëÔ∏è Eliminar Conciliaci√≥n Cargada</h3>
            <button class="modal-close-btn" onclick="cerrarConfirmarEliminarCargada()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">¬øEst√° seguro de eliminar la conciliaci√≥n que est√° trabajando?</p>

            <div id="eliminar-cargada-detalles" class="eliminar-detalles">
                <!-- Detalles din√°micos -->
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">‚ö†Ô∏è</span>
                <span>Esta acci√≥n eliminar√° permanentemente los datos de la base de datos.</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarConfirmarEliminarCargada()">Cancelar</button>
            <button class="btn-confirmar-eliminar" onclick="ejecutarEliminarConciliacionCargada()">üóëÔ∏è Eliminar</button>
        </div>
    </div>

    <!-- Modal de notas de conciliaci√≥n -->
    <div id="overlay-nota" class="overlay-eliminar"></div>
    <div id="modal-nota" class="modal-eliminar modal-nota" style="max-width: 500px;">
        <div class="modal-eliminar-header">
            <h3>üìù Nota del Movimiento</h3>
            <button class="modal-close-btn" onclick="cerrarModalNota()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">Agregue o edite una nota para este movimiento conciliado:</p>

            <div id="nota-detalles" class="eliminar-detalles">
                <!-- Contenido din√°mico con info del movimiento -->
            </div>

            <div class="nota-textarea-grupo">
                <label for="nota-contenido">Nota:</label>
                <textarea id="nota-contenido" class="nota-textarea" placeholder="Escriba una nota para este movimiento conciliado..." rows="4" maxlength="500"></textarea>
                <span class="nota-contador"><span id="nota-contador-chars">0</span>/500</span>
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">üí°</span>
                <span>Las notas se guardar√°n junto con la conciliaci√≥n</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarModalNota()">Cancelar</button>
            <button class="btn-confirmar-eliminar btn-guardar-nota" onclick="guardarNota()">üíæ Guardar Nota</button>
        </div>
    </div>

    <!-- Modal de eliminar -->
    <div id="overlay-eliminar" class="overlay-eliminar"></div>
    <div id="modal-eliminar" class="modal-eliminar">
        <div class="modal-eliminar-header">
            <h3>üóëÔ∏è Eliminar Movimiento</h3>
            <button class="modal-close-btn" onclick="cerrarModalEliminar()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">¬øEst√° seguro de eliminar este movimiento del proceso de conciliaci√≥n?</p>

            <div id="eliminar-detalles" class="eliminar-detalles">
                <!-- Contenido din√°mico -->
            </div>

            <div class="eliminar-motivo-grupo">
                <label for="eliminar-motivo">Motivo (opcional):</label>
                <input type="text" id="eliminar-motivo" class="eliminar-motivo-input" placeholder="Ej: Pago registrado en cuenta incorrecta">
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">‚ö†Ô∏è</span>
                <span>El movimiento podr√° ser restaurado desde la pesta√±a "Eliminados"</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarModalEliminar()">Cancelar</button>
            <button class="btn-confirmar-eliminar" onclick="confirmarEliminar()">üóëÔ∏è Eliminar</button>
        </div>
    </div>

    <!-- Contenedor de notificaciones flotantes -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="../../shared/globalNav.js"></script>
    <script src="script.js"></script>
</body>
</html>
