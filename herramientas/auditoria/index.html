<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditor√≠a - Herramientas Contables</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../supabase-config.js"></script>
    <link rel="stylesheet" href="../../css/buttons.css">
    <link rel="stylesheet" href="../../shared/globalNav.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script src="../../check-auth.js"></script>

    <!-- Barra de navegaci√≥n -->
    <div class="nav-bar">
        <a href="../../index.html" class="nav-btn">üè† Inicio</a>
        <a href="../../index.html" class="nav-btn">‚Üê Volver</a>
    </div>

    <div class="container">
        <div class="header">
            <h1>üîç Auditor√≠a</h1>
            <p>Herramientas de auditor√≠a para estados contables</p>
        </div>

        <!-- Panel de Selecci√≥n de Herramienta -->
        <div id="herramientasPanel" class="herramientas-auditoria-panel">
            <div class="herramientas-grid">
                <div class="herramienta-card" onclick="seleccionarHerramienta('extractos')">
                    <div class="herramienta-icon">üè¶</div>
                    <h3>Extractos Bancarios</h3>
                    <p>Gestione cuentas bancarias y extractos mensuales. Cargue, edite y clasifique movimientos.</p>
                    <ul class="herramienta-features">
                        <li>Carga de extractos Excel</li>
                        <li>Clasificaci√≥n de movimientos</li>
                        <li>Filtros avanzados</li>
                    </ul>
                </div>
                <div class="herramienta-card" onclick="seleccionarHerramienta('mayores')">
                    <div class="herramienta-icon">üìä</div>
                    <h3>An√°lisis de Mayores Contables</h3>
                    <p>Analice mayores contables de Tango. Vincule transacciones y concilie registros.</p>
                    <ul class="herramienta-features">
                        <li>Tipos de mayor configurables</li>
                        <li>Vinculaci√≥n de transacciones</li>
                        <li>An√°lisis de cupones de tarjetas</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- M√ìDULO: EXTRACTOS BANCARIOS -->
        <!-- ============================================ -->
        <div id="moduloExtractos" class="modulo-auditoria" style="display: none;">
            <div class="modulo-header">
                <button onclick="volverAHerramientas()" class="btn-back">‚Üê Volver</button>
                <h2>üè¶ Extractos Bancarios</h2>
            </div>

            <!-- Selector de Cliente -->
            <div class="cliente-selector">
                <div class="search-box">
                    <div class="selector-group">
                        <label>Seleccionar Cliente:</label>
                        <select id="clienteSelect" class="input-text" onchange="cargarDashboard()">
                            <option value="">-- Seleccione un cliente --</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <input type="text" id="clienteSearch" class="input-text" placeholder="üîç Filtrar clientes..." oninput="filtrarClientes()">
                    </div>
                </div>
            </div>

            <!-- Dashboard (se muestra al seleccionar cliente) -->
            <div id="dashboard" style="display: none;">
                <!-- Info del Cliente Seleccionado -->
                <div class="cliente-info">
                    <div class="cliente-datos">
                        <h3 id="clienteNombre"></h3>
                        <span id="clienteCuit"></span>
                    </div>
                    <button onclick="mostrarNuevaCuentaBancaria()" class="btn-primary">+ Nueva Cuenta Bancaria</button>
                </div>

                <!-- Panel de Cuentas Bancarias y Extractos -->
                <div class="cuentas-panel">
                    <div class="info-box">
                        <strong>Panel de Extractos Bancarios:</strong> Visualice todas las cuentas bancarias del cliente con sus extractos mensuales.
                        Puede cargar nuevos extractos, editarlos, filtrar movimientos y descargar reportes.
                    </div>

                    <!-- Lista de Cuentas con Extractos -->
                    <div id="cuentasList" class="cuentas-list">
                        <div class="empty-state">Seleccione un cliente para ver sus cuentas bancarias</div>
                    </div>
                </div>
            </div>

            <!-- Estado vac√≠o inicial -->
            <div id="emptyState" class="empty-state-container">
                <div class="empty-icon">üè¶</div>
                <h3>Seleccione un Cliente</h3>
                <p>Elija un cliente del selector superior para ver sus cuentas bancarias y extractos mensuales.</p>
            </div>

            <!-- Barra flotante de selecci√≥n de extractos para eliminaci√≥n masiva -->
            <div id="barraSeleccionExtractos" class="barra-seleccion-extractos hidden">
                <div class="seleccion-extractos-info">
                    <span class="seleccion-icono">üìã</span>
                    <span id="contadorExtractosSeleccionados">0 extractos seleccionados</span>
                </div>
                <div class="seleccion-extractos-acciones">
                    <button onclick="deseleccionarTodosExtractos()" class="btn-secondary btn-sm">Deseleccionar todos</button>
                    <button onclick="eliminarExtractosSeleccionados()" class="btn-danger btn-sm">üóëÔ∏è Eliminar seleccionados</button>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- M√ìDULO: AN√ÅLISIS DE MAYORES CONTABLES -->
        <!-- ============================================ -->
        <div id="moduloMayores" class="modulo-auditoria" style="display: none;">
            <div class="modulo-header">
                <button onclick="volverAHerramientas()" class="btn-back">‚Üê Volver</button>
                <h2>üìä An√°lisis de Mayores Contables</h2>
            </div>

            <!-- Selector de Cliente para Mayores -->
            <div class="cliente-selector">
                <div class="search-box">
                    <div class="selector-group">
                        <label>Seleccionar Cliente:</label>
                        <select id="clienteSelectMayores" class="input-text" onchange="cargarDashboardMayores()">
                            <option value="">-- Seleccione un cliente --</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <input type="text" id="clienteSearchMayores" class="input-text" placeholder="üîç Filtrar clientes..." oninput="filtrarClientesMayores()">
                    </div>
                </div>
            </div>

            <!-- Dashboard de Mayores -->
            <div id="dashboardMayores" style="display: none;">
                <!-- Info del Cliente Seleccionado -->
                <div class="cliente-info">
                    <div class="cliente-datos">
                        <h3 id="clienteNombreMayores"></h3>
                        <span id="clienteCuitMayores"></span>
                    </div>
                </div>

                <!-- Selector de Tipo de Mayor -->
                <div class="tipo-mayor-selector">
                    <div class="info-box">
                        <strong>Tipos de Mayores:</strong> Seleccione el tipo de mayor que desea analizar. Cada tipo tiene su propia l√≥gica de an√°lisis y vinculaci√≥n.
                    </div>
                    <div class="tipos-mayor-grid" id="tiposMayorGrid">
                        <!-- Se llena din√°micamente -->
                    </div>
                </div>

                <!-- Panel de An√°lisis de Mayor (se muestra al seleccionar tipo) -->
                <div id="panelAnalisisMayor" style="display: none;">
                    <div class="panel-mayor-header">
                        <h3 id="tipoMayorTitulo"></h3>
                        <p id="tipoMayorDescripcion"></p>
                    </div>

                    <!-- Toolbar -->
                    <div class="btn-group mb-4 toolbar">
                        <button onclick="mostrarSubirMayor()" class="btn-primary">üì§ Cargar Mayor</button>
                        <button id="btnCargarListadoCheques" onclick="mostrarCargarListadoCheques()" class="btn-secondary" style="display: none;">üìã Cargar Listado Cheques</button>
                        <button id="btnGestionConciliacionesMayor" onclick="abrirGestionConciliacionesMayor()" class="btn-secondary" disabled>üìÇ Gestionar Conciliaciones</button>
                        <button onclick="exportarAnalisisMayor()" class="btn-template">üì• Exportar An√°lisis</button>
                    </div>

                    <!-- Info del Mayor Cargado -->
                    <div id="infoMayorCargado" class="info-mayor-cargado" style="display: none;">
                        <div class="mayor-stats">
                            <div class="stat-item">
                                <span class="stat-label">Per√≠odo:</span>
                                <span class="stat-value" id="mayorPeriodo">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Registros:</span>
                                <span class="stat-value" id="mayorTotalRegistros">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Debe:</span>
                                <span class="stat-value debe" id="mayorTotalDebe">$0,00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Total Haber:</span>
                                <span class="stat-value haber" id="mayorTotalHaber">$0,00</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Saldo:</span>
                                <span class="stat-value" id="mayorSaldo">$0,00</span>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!-- PASO 1: Carga del Listado de Cheques (solo para cheques_terceros_recibidos) -->
                    <!-- ============================================ -->
                    <div id="panelConciliacionChequesDebe" class="panel-paso-conciliacion" style="display: none;">
                        <div class="paso-header">
                            <div class="paso-numero">1</div>
                            <div class="paso-titulo">
                                <h4>üìã Carga del Listado de Cheques</h4>
                                <p class="paso-descripcion">Cargue el listado de cheques recibidos desde un archivo Excel.</p>
                            </div>
                            <button class="btn-toggle-paso" onclick="togglePasoChequesDebe()">
                                <span id="iconTogglePaso1">‚ñº</span>
                            </button>
                        </div>

                        <div id="contenidoPaso1" class="paso-contenido">
                            <!-- Estado de carga del listado -->
                            <div id="estadoListadoCheques" class="estado-listado-cheques">
                                <div id="listadoNoCarado" class="listado-estado sin-cargar">
                                    <div class="estado-icono">üìÇ</div>
                                    <div class="estado-info">
                                        <h5>Listado de cheques no cargado</h5>
                                        <p>Cargue el listado de cheques recibidos desde un archivo Excel para luego conciliar con los registros del debe.</p>
                                    </div>
                                    <button onclick="mostrarCargarListadoCheques()" class="btn-primary">üìã Cargar Listado de Cheques</button>
                                </div>

                                <div id="listadoCargado" class="listado-estado cargado" style="display: none;">
                                    <div class="estado-icono">‚úÖ</div>
                                    <div class="estado-info">
                                        <h5>Listado de cheques cargado</h5>
                                        <p id="resumenListadoCheques">0 cheques cargados</p>
                                        <p id="resumenMesesDisponibles" class="text-muted"></p>
                                    </div>
                                    <div class="estado-acciones">
                                        <button onclick="mostrarCargarListadoCheques()" class="btn-secondary btn-sm">üîÑ Recargar listado</button>
                                        <button onclick="guardarListadoChequesLocal()" class="btn-success btn-sm">üíæ Guardar listado</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Resumen del listado cargado -->
                            <div id="resumenListadoChequesDetalle" class="resumen-listado-cheques" style="display: none;">
                                <div class="resumen-header">
                                    <h5>üìä Resumen del Listado Cargado</h5>
                                </div>
                                <div class="resumen-stats-grid">
                                    <div class="stat-item">
                                        <span class="stat-numero" id="totalChequesCargados">0</span>
                                        <span class="stat-label">Total cheques</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-numero" id="totalImporteCheques">$0</span>
                                        <span class="stat-label">Importe total</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-numero" id="totalMesesCheques">0</span>
                                        <span class="stat-label">Meses disponibles</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!-- PASO 2: Conciliaci√≥n Cheques vs Debe por Mes (solo para cheques_terceros_recibidos) -->
                    <!-- ============================================ -->
                    <div id="panelConciliacionPorMes" class="panel-paso-conciliacion" style="display: none;">
                        <div class="paso-header">
                            <div class="paso-numero">2</div>
                            <div class="paso-titulo">
                                <h4>üìÖ Conciliaci√≥n por Mes: Cheques vs Registros del Debe</h4>
                                <p class="paso-descripcion">Seleccione un mes y concilie los cheques con los registros del debe de forma gradual.</p>
                            </div>
                            <button class="btn-toggle-paso" onclick="togglePasoConciliacionPorMes()">
                                <span id="iconTogglePaso2Mes">‚ñº</span>
                            </button>
                        </div>

                        <div id="contenidoPaso2Mes" class="paso-contenido">
                            <!-- Selector de mes -->
                            <div class="selector-mes-container">
                                <div class="selector-mes-header">
                                    <h5>Seleccione un mes para conciliar</h5>
                                </div>
                                <div id="listaMesesConciliacion" class="lista-meses-grid">
                                    <!-- Se llena din√°micamente con los meses disponibles -->
                                </div>
                            </div>

                            <!-- Panel de conciliaci√≥n del mes seleccionado -->
                            <div id="panelMesSeleccionado" class="panel-mes-seleccionado" style="display: none;">
                                <div class="mes-seleccionado-header">
                                    <h5>üìÜ Conciliando: <span id="nombreMesSeleccionado">--</span></h5>
                                    <button onclick="cerrarConciliacionMes()" class="btn-secondary btn-sm">‚úï Cerrar</button>
                                </div>

                                <!-- Estad√≠sticas del mes -->
                                <div class="stats-conciliacion-paso stats-mes">
                                    <div class="stat-conciliacion completo">
                                        <span class="stat-numero" id="statMesCompletos">0</span>
                                        <span class="stat-label">Registros completos</span>
                                    </div>
                                    <div class="stat-conciliacion parcial">
                                        <span class="stat-numero" id="statMesParciales">0</span>
                                        <span class="stat-label">Asociaciones parciales</span>
                                    </div>
                                    <div class="stat-conciliacion sin-cheques">
                                        <span class="stat-numero" id="statMesSinCheques">0</span>
                                        <span class="stat-label">Sin cheques asociados</span>
                                    </div>
                                    <div class="stat-conciliacion no-asociados">
                                        <span class="stat-numero" id="statMesChequesNoAsociados">0</span>
                                        <span class="stat-label">Cheques sin asociar</span>
                                    </div>
                                </div>

                                <!-- Acciones de conciliaci√≥n del mes -->
                                <div class="acciones-conciliacion-mes">
                                    <button onclick="conciliarMesAutomaticamente()" class="btn-primary">ü§ñ Conciliar Autom√°ticamente</button>
                                    <button onclick="reprocesarChequesMes()" class="btn-secondary">üîÑ Reprocesar cheques sin asociar</button>
                                    <button onclick="guardarConciliacionMes()" class="btn-success">üíæ Guardar progreso del mes</button>
                                </div>

                                <!-- Tabla de asociaciones del mes -->
                                <div class="tabla-resumen-asociaciones">
                                    <div class="resumen-header">
                                        <h5>Detalle de Asociaciones del Mes</h5>
                                        <div class="resumen-filtros">
                                            <label class="filtro-inline">
                                                <input type="checkbox" id="filtroSoloPendientesMes" onchange="filtrarAsociacionesMes()">
                                                Solo mostrar con diferencias
                                            </label>
                                        </div>
                                    </div>
                                    <div class="preview-table-container" style="max-height: 400px;">
                                        <table class="preview-table tabla-asociaciones-cheques">
                                            <thead>
                                                <tr>
                                                    <th>Fecha</th>
                                                    <th>Asiento</th>
                                                    <th>Descripci√≥n</th>
                                                    <th class="text-right">Importe Debe</th>
                                                    <th class="text-right">Suma Cheques</th>
                                                    <th class="text-right">Diferencia</th>
                                                    <th>Estado</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tablaAsociacionesMesBody">
                                                <!-- Se llena din√°micamente -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Cheques sin asociar del mes -->
                                <div id="chequesNoAsociadosMes" class="cheques-no-asociados-panel" style="display: none;">
                                    <div class="cheques-no-asociados-header">
                                        <h5>‚ö†Ô∏è Cheques sin asociar del mes</h5>
                                    </div>
                                    <div class="preview-table-container" style="max-height: 250px;">
                                        <table class="preview-table">
                                            <thead>
                                                <tr>
                                                    <th>N√∫mero</th>
                                                    <th>Origen</th>
                                                    <th>F. Recepci√≥n</th>
                                                    <th class="text-right">Importe</th>
                                                    <th>Estado</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tablaChequesNoAsociadosMes">
                                                <!-- Se llena din√°micamente -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ============================================ -->
                    <!-- PASO 3: Conciliaci√≥n Debe con Haber -->
                    <!-- ============================================ -->
                    <div id="panelVinculacionCupones" class="panel-vinculacion panel-paso-conciliacion" style="display: none;">
                        <div class="paso-header">
                            <div class="paso-numero" id="numeroPasoVinculacion">3</div>
                            <div class="paso-titulo">
                                <h4 id="tituloPasoVinculacion">üîó Conciliaci√≥n: Ingresos (Debe) vs Usos (Haber)</h4>
                                <p class="paso-descripcion" id="descripcionPasoVinculacion">Vincule los registros de ingreso con sus correspondientes usos o dep√≥sitos.</p>
                            </div>
                            <button class="btn-toggle-paso" onclick="togglePasoVinculacion()">
                                <span id="iconTogglePaso2">‚ñº</span>
                            </button>
                        </div>

                        <div id="contenidoPaso2" class="paso-contenido">
                        <div class="vinculacion-header">
                            <h4>üîó Vinculaci√≥n de Cupones</h4>
                            <div class="vinculacion-stats">
                                <span class="stat vinculados"><span id="cuponesVinculados">0</span> vinculados</span>
                                <span class="stat pendientes"><span id="cuponesPendientes">0</span> pendientes</span>
                                <span class="stat vencidos"><span id="cuponesVencidos">0</span> vencidos (+40 d√≠as)</span>
                            </div>
                        </div>

                        <div class="vinculacion-info">
                            <p><strong>L√≥gica de vinculaci√≥n:</strong> Los cupones (d√©bitos) deben vincularse con liquidaciones (cr√©ditos) dentro de 40 d√≠as.</p>
                        </div>

                        <!-- Filtros de vinculaci√≥n -->
                        <div class="vinculacion-filtros">
                            <div class="filtro-item">
                                <label>Estado:</label>
                                <select id="filtroEstadoVinculacion" class="input-text" onchange="filtrarVinculaciones()">
                                    <option value="">Todos</option>
                                    <option value="pendiente">Pendientes</option>
                                    <option value="vinculado">Vinculados</option>
                                    <option value="vencido">Vencidos</option>
                                    <option value="devolucion">Devoluciones</option>
                                </select>
                            </div>
                            <div class="filtro-item">
                                <label>Buscar:</label>
                                <input type="text" id="filtroTextoVinculacion" class="input-text" placeholder="Buscar en descripci√≥n..." oninput="filtrarVinculaciones()">
                            </div>
                        </div>

                        <!-- √Årea de trabajo dividida -->
                        <div class="vinculacion-workspace">
                            <!-- Columna de Cupones (D√©bitos) -->
                            <div class="vinculacion-columna cupones-columna">
                                <div class="columna-header">
                                    <h5>üìã Cupones (Debe)</h5>
                                    <span class="columna-total" id="totalCuponesDebe">$0,00</span>
                                </div>
                                <div class="columna-acciones">
                                    <button onclick="seleccionarTodosCupones()" class="btn-secondary btn-xs">Seleccionar todos</button>
                                </div>
                                <div class="registros-lista" id="listaCupones">
                                    <!-- Se llena din√°micamente -->
                                </div>
                            </div>

                            <!-- Columna de Liquidaciones (Cr√©ditos) -->
                            <div class="vinculacion-columna liquidaciones-columna">
                                <div class="columna-header">
                                    <h5>üí∞ Liquidaciones (Haber)</h5>
                                    <span class="columna-total" id="totalLiquidacionesHaber">$0,00</span>
                                </div>
                                <div class="columna-acciones">
                                    <button onclick="seleccionarTodasLiquidaciones()" class="btn-secondary btn-xs">Seleccionar todas</button>
                                </div>
                                <div class="registros-lista" id="listaLiquidaciones">
                                    <!-- Se llena din√°micamente -->
                                </div>
                            </div>
                        </div>

                        <!-- Acciones de vinculaci√≥n -->
                        <div class="vinculacion-acciones">
                            <button onclick="conciliarAutomaticamente()" class="btn-conciliar">ü§ñ Conciliar Autom√°ticamente</button>
                            <button onclick="vincularSeleccionados()" class="btn-primary">üîó Vincular Seleccionados</button>
                            <button onclick="desvincularSeleccionados()" class="btn-warning">‚Ü©Ô∏è Desvincular</button>
                            <button onclick="marcarComoDevolucion()" class="btn-secondary">üîÑ Marcar como Devoluci√≥n</button>
                            <button onclick="mostrarModalGuardarConciliacionMayor()" class="btn-success">üíæ Guardar</button>
                        </div>

                        <!-- Panel de configuraci√≥n de conciliaci√≥n autom√°tica -->
                        <div id="panelConfigConciliacion" class="config-conciliacion" style="display: none;">
                            <h5>‚öôÔ∏è Configuraci√≥n de Conciliaci√≥n Autom√°tica</h5>
                            <div class="config-row">
                                <div class="config-item">
                                    <label>Tolerancia de importe:</label>
                                    <input type="number" id="toleranciaImporte" class="input-text" value="0.01" min="0" step="0.01">
                                    <span class="config-hint">Diferencia m√°xima permitida en $</span>
                                </div>
                                <div class="config-item">
                                    <label>D√≠as m√°ximos entre origen y destino:</label>
                                    <input type="number" id="diasMaximos" class="input-text" value="40" min="1" max="90">
                                    <span class="config-hint">Plazo m√°ximo para vincular</span>
                                </div>
                                <div class="config-item">
                                    <label>Modo de conciliaci√≥n:</label>
                                    <select id="modoConciliacion" class="input-text">
                                        <option value="1:1">1:1 - Un registro con un registro</option>
                                        <option value="N:1" selected>N:1 - Varios registros con un registro</option>
                                        <option value="1:N">1:N - Un registro con varios registros</option>
                                    </select>
                                </div>
                            </div>
                            <div class="config-actions">
                                <button onclick="ejecutarConciliacion()" class="btn-primary">‚ñ∂Ô∏è Ejecutar Conciliaci√≥n</button>
                                <button onclick="cerrarConfigConciliacion()" class="btn-secondary">Cancelar</button>
                            </div>
                        </div>

                        <!-- Panel de progreso de conciliaci√≥n -->
                        <div id="panelProgresoConciliacion" class="progreso-conciliacion" style="display: none;">
                            <h5>‚è≥ Ejecutando Conciliaci√≥n Autom√°tica</h5>
                            <div class="progreso-contenedor">
                                <div class="progreso-barra-contenedor">
                                    <div id="progresoConciliacionBarra" class="progreso-barra"></div>
                                </div>
                                <span id="progresoConciliacionTexto" class="progreso-texto">0%</span>
                            </div>
                            <div id="progresoConciliacionDetalle" class="progreso-detalle">
                                Preparando...
                            </div>
                        </div>

                        <!-- Resultados de conciliaci√≥n -->
                        <div id="resultadosConciliacion" class="resultados-conciliacion" style="display: none;">
                            <h5>üìä Resultados de Conciliaci√≥n Autom√°tica</h5>
                            <div class="resultados-stats">
                                <div class="resultado-item exito">
                                    <span class="resultado-numero" id="conciliacionExitosas">0</span>
                                    <span class="resultado-label">Vinculaciones exitosas</span>
                                </div>
                                <div class="resultado-item pendiente">
                                    <span class="resultado-numero" id="conciliacionPendientes">0</span>
                                    <span class="resultado-label" id="labelOrigenSinMatch">Cupones sin match</span>
                                </div>
                                <div class="resultado-item info">
                                    <span class="resultado-numero" id="conciliacionLiquidaciones">0</span>
                                    <span class="resultado-label" id="labelDestinoSinMatch">Liquidaciones sin match</span>
                                </div>
                            </div>
                            <button onclick="cerrarResultadosConciliacion()" class="btn-secondary btn-sm">Cerrar</button>
                        </div>
                        </div><!-- Cierre contenidoPaso2 -->
                    </div>

                    <!-- Tabla de registros del mayor -->
                    <div class="preview-container mt-4">
                        <div class="preview-header">
                            <h4>Registros del Mayor</h4>
                            <div class="preview-actions" style="display: flex; gap: 16px; flex-wrap: wrap;">
                                <label>
                                    <input type="checkbox" id="mostrarSoloNoVinculados" onchange="filtrarRegistrosMayor()">
                                    Mostrar solo no vinculados
                                </label>
                                <label id="filtroParcialesLabel" style="display: none;">
                                    <input type="checkbox" id="mostrarSoloParciales" onchange="filtrarRegistrosMayor()">
                                    ‚ö†Ô∏è Solo asociaciones parciales
                                </label>
                            </div>
                        </div>
                        <div class="preview-table-container">
                            <table id="tablaMayor" class="preview-table">
                                <thead>
                                    <tr>
                                        <th class="checkbox-col"><input type="checkbox" id="selectAllMayor" onchange="toggleSeleccionarTodosMayor(this)"></th>
                                        <th>Fecha</th>
                                        <th>Asiento</th>
                                        <th>Descripci√≥n</th>
                                        <th class="text-right">Debe</th>
                                        <th class="text-right">Haber</th>
                                        <th>Estado</th>
                                        <th>Vinculado con</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaMayorBody">
                                    <!-- Se llena din√°micamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estado vac√≠o para Mayores -->
            <div id="emptyStateMayores" class="empty-state-container">
                <div class="empty-icon">üìä</div>
                <h3>Seleccione un Cliente</h3>
                <p>Elija un cliente del selector superior para comenzar el an√°lisis de mayores contables.</p>
            </div>

            <!-- Barra de selecci√≥n flotante para vinculaci√≥n manual -->
            <div id="selectionBarMayores" class="selection-bar-mayores hidden">
                <div class="selection-summary">
                    <div class="selection-group cupones-group">
                        <span class="selection-icon">üìã</span>
                        <span class="selection-label">Cupones:</span>
                        <span id="selCuponesCount" class="selection-count">0</span>
                        <span class="selection-amount">(<span id="selCuponesTotal">$0,00</span>)</span>
                    </div>
                    <div class="selection-separator">+</div>
                    <div class="selection-group liquidaciones-group">
                        <span class="selection-icon">üí∞</span>
                        <span class="selection-label">Liquidaciones:</span>
                        <span id="selLiquidacionesCount" class="selection-count">0</span>
                        <span class="selection-amount">(<span id="selLiquidacionesTotal">$0,00</span>)</span>
                    </div>
                    <div class="selection-separator">=</div>
                    <div class="selection-group selection-diff">
                        <span class="selection-label">Diferencia:</span>
                        <span id="selDiferenciaMayores" class="selection-diff-value">$0,00</span>
                    </div>
                </div>
                <div class="selection-actions">
                    <button onclick="limpiarSeleccionMayores()" class="btn-selection-clear" title="Limpiar selecci√≥n">‚úï Limpiar</button>
                    <button id="btnVincularMayores" onclick="vincularSeleccionadosManual()" class="btn-vincular-mayores" disabled>üîó Vincular Seleccionados</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nueva/Editar Cuenta Bancaria -->
    <div id="modalNuevaCuentaBancaria" class="modal hidden">
        <div class="modal-content-sm">
            <h3>Cuenta Bancaria</h3>
            <input type="hidden" id="cuentaBancariaId">
            <label>Banco:</label>
            <input type="text" id="cuentaBanco" placeholder="Ej: Banco Galicia" class="input-text mb-4">
            <label>Tipo de Cuenta:</label>
            <select id="cuentaTipo" class="input-text mb-4">
                <option value="Cuenta Corriente">Cuenta Corriente</option>
                <option value="Caja de Ahorro">Caja de Ahorro</option>
                <option value="Cuenta √önica">Cuenta √önica</option>
            </select>
            <label>N√∫mero de Cuenta / CBU:</label>
            <input type="text" id="cuentaNumero" placeholder="Ej: 0070001234567890123456" class="input-text mb-4">
            <label>Alias (Opcional):</label>
            <input type="text" id="cuentaAlias" placeholder="Ej: CUENTA.PRINCIPAL" class="input-text mb-4">
            <div class="btn-group">
                <button onclick="cerrarNuevaCuentaBancaria()" class="btn-secondary">Cancelar</button>
                <button onclick="guardarCuentaBancaria()" class="btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Extractos Mensuales -->
    <div id="modalExtractosMensuales" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Extractos Mensuales - <span id="extractosCuentaNombre"></span></h2>
                <button class="close-btn" onclick="cerrarExtractosMensuales()">‚úï</button>
            </div>

            <div class="btn-group mb-4">
                <button onclick="mostrarSubirExtracto()" class="btn-primary flex-1">üì§ Subir Extracto</button>
            </div>

            <div class="info-box">
                <strong>Formato:</strong> Suba el archivo Excel generado por el Conversor de Extractos Bancarios.<br>
                <strong>Columnas esperadas:</strong> Fecha | Descripci√≥n | Origen | Cr√©dito | D√©bito | Saldo
            </div>

            <div id="extractosMensualesList" class="extractos-list"></div>
        </div>
    </div>

    <!-- Modal Subir Extracto -->
    <div id="modalSubirExtracto" class="modal hidden">
        <div class="modal-content-sm">
            <h3>Subir Extracto</h3>
            <div class="info-box mb-4">
                <strong>üìÖ Detecci√≥n autom√°tica:</strong> El mes y a√±o se detectar√°n autom√°ticamente de las fechas del archivo.
            </div>
            <label>Archivo Excel:</label>
            <input type="file" id="extractoFile" accept=".xlsx,.xls" class="input-text mb-4" onchange="handleExtractoFileChange(event)">
            <div id="extractoFileInfo" class="file-info"></div>
            <div id="extractoPreviewInfo" class="preview-info" style="display: none;"></div>
            <div class="btn-group">
                <button onclick="cerrarSubirExtracto()" class="btn-secondary">Cancelar</button>
                <button onclick="procesarExtracto()" class="btn-primary">Procesar y Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Seleccionar Rango de Fechas -->
    <div id="modalRangoFechas" class="modal hidden">
        <div class="modal-content-sm">
            <h3>üìÖ Ver extractos por rango de fechas</h3>
            <p class="info-text">Seleccione un rango para ver y clasificar movimientos de m√∫ltiples meses a la vez.</p>

            <input type="hidden" id="rangoCuentaId">
            <input type="hidden" id="rangoCuentaNombre">

            <div class="rango-fechas-grid">
                <div class="rango-field">
                    <label>Desde:</label>
                    <div class="rango-selects">
                        <select id="rangoMesDesde" class="input-text">
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                        <input type="number" id="rangoAnioDesde" class="input-text" min="2000" max="2100" placeholder="A√±o">
                    </div>
                </div>
                <div class="rango-field">
                    <label>Hasta:</label>
                    <div class="rango-selects">
                        <select id="rangoMesHasta" class="input-text">
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                        <input type="number" id="rangoAnioHasta" class="input-text" min="2000" max="2100" placeholder="A√±o">
                    </div>
                </div>
            </div>

            <div class="btn-group mt-4">
                <button onclick="cerrarModalRangoFechas()" class="btn-secondary">Cancelar</button>
                <button onclick="cargarExtractosPorRango()" class="btn-primary">Ver Extractos</button>
            </div>
        </div>
    </div>

    <!-- Modal Detalle de Extracto -->
    <div id="modalDetalleExtracto" class="modal hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>üìä Detalle Extracto - <span id="detalleExtractoPeriodo"></span></h2>
                <button class="close-btn" onclick="cerrarDetalleExtracto()">‚úï</button>
            </div>

            <!-- Barra de herramientas -->
            <div class="btn-group mb-4 toolbar">
                <button onclick="agregarMovimiento()" class="btn-primary">+ Agregar Movimiento</button>
                <button onclick="restaurarMovimientos()" class="btn-warning">‚Ü©Ô∏è Restaurar Eliminados</button>
                <button onclick="restaurarDatosOriginales()" class="btn-secondary">üîÑ Restaurar Original</button>
                <button onclick="guardarCambiosExtracto()" class="btn-success">üíæ Guardar Cambios</button>
                <button onclick="descargarExtractoExcel()" class="btn-template">üì• Descargar Excel</button>
            </div>

            <!-- Barra de acciones para seleccionados (oculta por defecto) -->
            <div id="barraSeleccionados" class="barra-seleccionados hidden">
                <div class="seleccion-info">
                    <span id="contadorSeleccionados">0 seleccionados</span>
                    <button onclick="deseleccionarTodos()" class="btn-link">Deseleccionar todos</button>
                </div>
                <div class="seleccion-acciones">
                    <select id="categoriaSeleccionados" class="input-text categoria-select-accion">
                        <!-- Opciones se llenan din√°micamente -->
                    </select>
                    <button onclick="clasificarSeleccionados()" class="btn-primary btn-sm">üè∑Ô∏è Clasificar</button>
                    <button onclick="cambiarDescripcionSeleccionados()" class="btn-secondary btn-sm">‚úèÔ∏è Cambiar Descripci√≥n</button>
                    <button onclick="eliminarSeleccionados()" class="btn-danger btn-sm">üóëÔ∏è Eliminar</button>
                </div>
            </div>

            <!-- Filtros de texto -->
            <div class="filtros-extracto">
                <div class="filtro-item">
                    <label>Filtrar por Fecha:</label>
                    <input type="text" id="filtroFecha" placeholder="Ej: 15/01" class="input-text">
                </div>
                <div class="filtro-item filtro-desc">
                    <label>Filtrar por Descripci√≥n:</label>
                    <input type="text" id="filtroDescripcion" placeholder="Buscar en descripci√≥n..." class="input-text">
                </div>
                <div class="filtro-item">
                    <label>Filtrar por Origen:</label>
                    <input type="text" id="filtroOrigen" placeholder="Buscar origen..." class="input-text">
                </div>
                <div class="filtro-item filtro-btn">
                    <button onclick="limpiarFiltrosExtracto()" class="btn-secondary">Limpiar</button>
                </div>
            </div>

            <!-- Panel de Marcadores/Categor√≠as -->
            <div class="marcadores-panel">
                <!-- Asignaci√≥n masiva de marcadores -->
                <div class="asignar-marcador-section">
                    <div class="asignar-marcador-row">
                        <span class="asignar-label">üè∑Ô∏è Asignar a filtrados:</span>
                        <select id="marcadorAsignar" class="input-text marcador-select">
                            <!-- Opciones se llenan din√°micamente -->
                        </select>
                        <button onclick="asignarMarcadorFiltrados()" class="btn-primary btn-sm">Aplicar</button>
                        <button onclick="quitarMarcadorFiltrados()" class="btn-secondary btn-sm">Quitar categor√≠a</button>
                        <button onclick="abrirGestionCategorias()" class="btn-template btn-sm" title="Gestionar categor√≠as">‚öôÔ∏è Gestionar</button>
                    </div>
                </div>

                <!-- Filtro por marcadores -->
                <div class="filtro-marcadores-section">
                    <span class="filtro-marcadores-label">Filtrar por categor√≠a:</span>
                    <div id="filtroMarcadoresContainer" class="filtro-marcadores-container">
                        <!-- Checkboxes se llenan din√°micamente -->
                    </div>
                    <button onclick="limpiarFiltroMarcadores()" class="btn-secondary btn-xs">Limpiar</button>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div id="detalleExtractoStats" class="stats-bar"></div>

            <!-- Tabla de movimientos -->
            <div class="preview-container">
                <div class="preview-table-container">
                    <table id="detalleExtractoTable" class="preview-table">
                        <thead>
                            <tr>
                                <th class="checkbox-col">
                                    <input type="checkbox" id="selectAllMovimientos" onchange="toggleSeleccionarTodos(this)" title="Seleccionar todos">
                                </th>
                                <th data-sort="categoria" onclick="ordenarPorColumna('categoria')" class="sortable categoria-col">Categor√≠a <span class="sort-indicator">‚áÖ</span></th>
                                <th data-sort="fecha" onclick="ordenarPorColumna('fecha')" class="sortable">Fecha <span class="sort-indicator">‚áÖ</span></th>
                                <th data-sort="descripcion" onclick="ordenarPorColumna('descripcion')" class="sortable">Descripci√≥n <span class="sort-indicator">‚áÖ</span></th>
                                <th data-sort="origen" onclick="ordenarPorColumna('origen')" class="sortable">Origen <span class="sort-indicator">‚áÖ</span></th>
                                <th data-sort="credito" onclick="ordenarPorColumna('credito')" class="sortable text-right">Cr√©dito <span class="sort-indicator">‚áÖ</span></th>
                                <th data-sort="debito" onclick="ordenarPorColumna('debito')" class="sortable text-right">D√©bito <span class="sort-indicator">‚áÖ</span></th>
                                <th data-sort="saldo" onclick="ordenarPorColumna('saldo')" class="sortable text-right">Saldo <span class="sort-indicator">‚áÖ</span></th>
                                <th class="actions-col">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="detalleExtractoBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="info-box mt-4">
                <strong>Tips:</strong><br>
                ‚Ä¢ Haga clic en la descripci√≥n para editarla inline.<br>
                ‚Ä¢ <strong>Clasificar movimientos:</strong> Filtre por descripci√≥n, luego use "Asignar a filtrados" para categorizar todos los movimientos visibles.<br>
                ‚Ä¢ <strong>Filtrar por categor√≠a:</strong> Seleccione una o m√°s categor√≠as en los checkboxes para ver solo esos movimientos.
            </div>
        </div>
    </div>

    <!-- Modal Gesti√≥n de Categor√≠as -->
    <div id="modalGestionCategorias" class="modal hidden">
        <div class="modal-content modal-categorias">
            <div class="modal-header">
                <h2>‚öôÔ∏è Gesti√≥n de Categor√≠as</h2>
                <button class="close-btn" onclick="cerrarGestionCategorias()">‚úï</button>
            </div>

            <div class="info-box">
                <strong>Gesti√≥n de categor√≠as:</strong> Cree, edite o elimine categor√≠as para clasificar los movimientos bancarios.
                Los cambios se guardan autom√°ticamente en la base de datos.
            </div>

            <!-- Formulario para nueva categor√≠a -->
            <div class="nueva-categoria-form">
                <h4>Nueva Categor√≠a</h4>
                <div class="categoria-form-row">
                    <div class="categoria-form-field">
                        <label>ID (√∫nico):</label>
                        <input type="text" id="nuevaCategoriaId" class="input-text" placeholder="ej: gastos_varios">
                    </div>
                    <div class="categoria-form-field">
                        <label>Nombre:</label>
                        <input type="text" id="nuevaCategoriaNombre" class="input-text" placeholder="ej: Gastos Varios">
                    </div>
                    <div class="categoria-form-field categoria-color-field">
                        <label>Color:</label>
                        <input type="color" id="nuevaCategoriaColor" class="input-color" value="#64748b">
                    </div>
                    <div class="categoria-form-field categoria-btn-field">
                        <button onclick="agregarCategoria()" class="btn-primary">+ Agregar</button>
                    </div>
                </div>
            </div>

            <!-- Lista de categor√≠as existentes -->
            <div class="categorias-lista-container">
                <h4>Categor√≠as Existentes</h4>
                <div id="categoriasLista" class="categorias-lista">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <div class="btn-group mt-4">
                <button onclick="cerrarGestionCategorias()" class="btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Editar Categor√≠a -->
    <div id="modalEditarCategoria" class="modal hidden">
        <div class="modal-content-sm">
            <h3>Editar Categor√≠a</h3>
            <input type="hidden" id="editarCategoriaIdOriginal">
            <label>ID (√∫nico):</label>
            <input type="text" id="editarCategoriaId" class="input-text mb-4" placeholder="ej: gastos_varios">
            <label>Nombre:</label>
            <input type="text" id="editarCategoriaNombre" class="input-text mb-4" placeholder="ej: Gastos Varios">
            <label>Color:</label>
            <input type="color" id="editarCategoriaColor" class="input-color mb-4" value="#64748b">
            <div class="btn-group">
                <button onclick="cerrarEditarCategoria()" class="btn-secondary">Cancelar</button>
                <button onclick="guardarEdicionCategoria()" class="btn-primary">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Subir Mayor Contable -->
    <div id="modalSubirMayor" class="modal hidden">
        <div class="modal-content-sm">
            <h3>üì§ Cargar Mayor Contable</h3>
            <div class="info-box mb-4">
                <strong>Formato esperado:</strong> Archivo Excel exportado desde Tango con las columnas:
                Fecha | Asiento | Descripci√≥n | Debe | Haber
            </div>
            <label>Archivo Excel:</label>
            <input type="file" id="mayorFile" accept=".xlsx,.xls" class="input-text mb-4" onchange="handleMayorFileChange(event)">
            <div id="mayorFileInfo" class="file-info"></div>
            <div id="mayorPreviewInfo" class="preview-info" style="display: none;"></div>
            <div class="btn-group">
                <button onclick="cerrarSubirMayor()" class="btn-secondary">Cancelar</button>
                <button onclick="procesarMayor()" class="btn-primary">Procesar</button>
            </div>
        </div>
    </div>

    <!-- Modal Cargar Listado de Cheques Recibidos -->
    <div id="modalCargarListadoCheques" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Cargar Listado de Cheques Recibidos</h2>
                <button class="close-btn" onclick="cerrarCargarListadoCheques()">‚úï</button>
            </div>
            <div class="info-box mb-4">
                <strong>Objetivo:</strong> Enriquecer el an√°lisis del mayor incorporando el detalle de cada cheque recibido.
                Los registros del debe que agrupan m√∫ltiples cheques ser√°n reemplazados por el detalle individual de cada cheque.
            </div>
            <div class="info-box mb-4" style="background: #fef3c7; border-color: #f59e0b;">
                <strong>Formato esperado del archivo Excel:</strong><br>
                Interno | Numero | Fecha Emision | Fecha Recepcion | Fecha cobro | FechaRechazo | FechaDeposito | FechaTransferencia | Origen | Destino | Importe | Estado
            </div>
            <label>Archivo Excel con listado de cheques:</label>
            <input type="file" id="listadoChequesFile" accept=".xlsx,.xls" class="input-text mb-4" onchange="handleListadoChequesFileChange(event)">
            <div id="listadoChequesFileInfo" class="file-info"></div>
            <div id="listadoChequesPreviewInfo" class="preview-info" style="display: none;"></div>

            <!-- Comparaci√≥n de sumas -->
            <div id="comparacionSumasPanel" class="comparacion-sumas-panel" style="display: none;">
                <h4>Comparaci√≥n de Totales</h4>
                <div class="comparacion-grid">
                    <div class="comparacion-item">
                        <span class="comparacion-label">Total Debe del Mayor:</span>
                        <span class="comparacion-valor debe" id="totalDebeMayorComparacion">$0,00</span>
                    </div>
                    <div class="comparacion-item">
                        <span class="comparacion-label">Total Listado Cheques:</span>
                        <span class="comparacion-valor" id="totalListadoChequesComparacion">$0,00</span>
                    </div>
                    <div class="comparacion-item diferencia">
                        <span class="comparacion-label">Diferencia:</span>
                        <span class="comparacion-valor" id="diferenciaComparacion">$0,00</span>
                    </div>
                </div>
                <div id="mensajeComparacion" class="mensaje-comparacion"></div>
            </div>

            <!-- Panel de progreso de incorporaci√≥n de cheques -->
            <div id="panelProgresoCheques" class="progreso-conciliacion progreso-cheques" style="display: none;">
                <h5>‚è≥ Incorporando Cheques al Mayor</h5>
                <div class="progreso-contenedor">
                    <div class="progreso-barra-contenedor">
                        <div id="progresoChequeBarra" class="progreso-barra"></div>
                    </div>
                    <span id="progresoChequeTexto" class="progreso-texto">0%</span>
                </div>
                <div id="progresoChequeDetalle" class="progreso-detalle">
                    Preparando...
                </div>
            </div>

            <div id="botonesModalCheques" class="btn-group mt-4">
                <button onclick="cerrarCargarListadoCheques()" class="btn-secondary">Cancelar</button>
                <button id="btnProcesarListadoCheques" onclick="procesarListadoCheques()" class="btn-primary" disabled>Incorporar Cheques</button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmaci√≥n Diferencia Listado Cheques -->
    <div id="modalConfirmarDiferenciaListado" class="modal hidden">
        <div class="modal-content-sm">
            <h3>‚ö†Ô∏è Diferencia Detectada</h3>
            <div class="info-box mb-4" style="background: #fef3c7; border-color: #f59e0b;">
                <p>La suma del listado de cheques no coincide con la suma de registros en el debe del mayor.</p>
                <div class="comparacion-resumida">
                    <p><strong>Total Debe Mayor:</strong> <span id="confirmTotalDebeMayor">$0,00</span></p>
                    <p><strong>Total Listado:</strong> <span id="confirmTotalListado">$0,00</span></p>
                    <p><strong>Diferencia:</strong> <span id="confirmDiferencia" style="color: #dc2626;">$0,00</span></p>
                </div>
            </div>
            <p class="mb-4">¬øDesea incorporar el listado de cheques de todas formas?</p>
            <div class="btn-group">
                <button onclick="cerrarConfirmarDiferenciaListado()" class="btn-secondary">Cancelar</button>
                <button onclick="confirmarIncorporarListadoConDiferencia()" class="btn-warning">Incorporar de todas formas</button>
            </div>
        </div>
    </div>

    <!-- Modal Configurar Tipo de Mayor -->
    <div id="modalConfigurarTipoMayor" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configurar Tipos de Mayores</h2>
                <button class="close-btn" onclick="cerrarConfigurarTipoMayor()">‚úï</button>
            </div>

            <div class="info-box">
                <strong>Tipos de Mayores:</strong> Configure los diferentes tipos de mayores contables que desea analizar.
                Cada tipo puede tener su propia l√≥gica de an√°lisis y vinculaci√≥n.
            </div>

            <!-- Formulario para nuevo tipo -->
            <div class="nueva-categoria-form">
                <h4>Nuevo Tipo de Mayor</h4>
                <div class="categoria-form-row">
                    <div class="categoria-form-field">
                        <label>ID (√∫nico):</label>
                        <input type="text" id="nuevoTipoMayorId" class="input-text" placeholder="ej: cupones_tarjetas">
                    </div>
                    <div class="categoria-form-field">
                        <label>Nombre:</label>
                        <input type="text" id="nuevoTipoMayorNombre" class="input-text" placeholder="ej: Cupones de Tarjetas">
                    </div>
                </div>
                <div class="categoria-form-row">
                    <div class="categoria-form-field" style="flex: 2;">
                        <label>Descripci√≥n:</label>
                        <input type="text" id="nuevoTipoMayorDescripcion" class="input-text" placeholder="Descripci√≥n del tipo de mayor...">
                    </div>
                    <div class="categoria-form-field">
                        <label>L√≥gica:</label>
                        <select id="nuevoTipoMayorLogica" class="input-text">
                            <option value="vinculacion">Vinculaci√≥n Debe/Haber</option>
                            <option value="simple">An√°lisis Simple</option>
                        </select>
                    </div>
                    <div class="categoria-form-field categoria-btn-field">
                        <button onclick="agregarTipoMayor()" class="btn-primary">+ Agregar</button>
                    </div>
                </div>
            </div>

            <!-- Lista de tipos existentes -->
            <div class="categorias-lista-container">
                <h4>Tipos de Mayores Configurados</h4>
                <div id="tiposMayorLista" class="categorias-lista">
                    <!-- Se llena din√°micamente -->
                </div>
            </div>

            <div class="btn-group mt-4">
                <button onclick="cerrarConfigurarTipoMayor()" class="btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal de conciliaciones guardadas de mayores - Selecci√≥n -->
    <div id="overlay-conciliacion-mayor-guardada" class="overlay-eliminar"></div>
    <div id="modal-conciliacion-mayor-guardada" class="modal-eliminar modal-gestion-conciliaciones" style="max-width: 600px;">
        <div class="modal-eliminar-header">
            <h3>üìÇ Conciliaciones Guardadas</h3>
            <button class="modal-close-btn" onclick="cerrarModalConciliacionMayorGuardada()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">Se encontraron conciliaciones guardadas para este mayor. Seleccione una para cargar:</p>

            <div id="conciliaciones-mayor-seleccion-lista" class="conciliaciones-seleccion-lista">
                <!-- Lista din√°mica de conciliaciones -->
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">üí°</span>
                <span>Al cargar una conciliaci√≥n, se restaurar√°n todos los registros y vinculaciones guardadas.</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="nuevaConciliacionMayor()">Nueva Conciliaci√≥n</button>
            <button id="btnConfirmarCargarConciliacionMayor" class="btn-confirmar-eliminar" style="background: #28a745;" onclick="confirmarCargarConciliacionMayorSeleccionada()" disabled>üìÇ Cargar Seleccionada</button>
        </div>
    </div>

    <!-- Modal de gesti√≥n de conciliaciones de mayores -->
    <div id="overlay-gestion-conciliaciones-mayor" class="overlay-eliminar"></div>
    <div id="modal-gestion-conciliaciones-mayor" class="modal-eliminar modal-gestion-conciliaciones">
        <div class="modal-eliminar-header">
            <h3>üìã Gesti√≥n de Conciliaciones Guardadas</h3>
            <button class="modal-close-btn" onclick="cerrarGestionConciliacionesMayor()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">Administre las conciliaciones guardadas para este cliente y tipo de mayor:</p>

            <div id="gestion-conciliaciones-mayor-lista" class="conciliaciones-lista">
                <!-- Lista din√°mica de conciliaciones -->
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarGestionConciliacionesMayor()">Cerrar</button>
        </div>
    </div>

    <!-- Modal de confirmar eliminaci√≥n de conciliaci√≥n de mayor -->
    <div id="overlay-confirmar-eliminar-conciliacion-mayor" class="overlay-eliminar"></div>
    <div id="modal-confirmar-eliminar-conciliacion-mayor" class="modal-eliminar" style="max-width: 450px;">
        <div class="modal-eliminar-header">
            <h3>üóëÔ∏è Eliminar Conciliaci√≥n</h3>
            <button class="modal-close-btn" onclick="cerrarConfirmarEliminarConciliacionMayor()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">¬øEst√° seguro de eliminar esta conciliaci√≥n guardada?</p>

            <div id="eliminar-conciliacion-mayor-detalles" class="eliminar-detalles">
                <!-- Detalles din√°micos -->
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">‚ö†Ô∏è</span>
                <span>Esta acci√≥n no se puede deshacer. Se perder√°n todos los datos de la conciliaci√≥n.</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarConfirmarEliminarConciliacionMayor()">Cancelar</button>
            <button class="btn-confirmar-eliminar" onclick="ejecutarEliminarConciliacionMayor()">üóëÔ∏è Eliminar</button>
        </div>
    </div>

    <!-- Modal para guardar conciliaci√≥n con nombre -->
    <div id="overlay-guardar-conciliacion-mayor" class="overlay-eliminar"></div>
    <div id="modal-guardar-conciliacion-mayor" class="modal-eliminar" style="max-width: 450px;">
        <div class="modal-eliminar-header">
            <h3>üíæ Guardar Conciliaci√≥n</h3>
            <button class="modal-close-btn" onclick="cerrarModalGuardarConciliacionMayor()">‚úï</button>
        </div>
        <div class="modal-eliminar-body">
            <p class="modal-eliminar-pregunta">Ingrese un nombre para identificar esta conciliaci√≥n:</p>

            <div class="form-group" style="margin: 16px 0;">
                <label for="nombreConciliacionMayor">Nombre de la conciliaci√≥n:</label>
                <input type="text" id="nombreConciliacionMayor" class="input-text" placeholder="Ej: Conciliaci√≥n Enero 2024" style="width: 100%; margin-top: 8px;">
            </div>

            <div class="eliminar-aviso">
                <span class="aviso-icono">üí°</span>
                <span>Puede guardar m√∫ltiples conciliaciones con diferentes nombres.</span>
            </div>
        </div>
        <div class="modal-eliminar-footer">
            <button class="btn-cancelar" onclick="cerrarModalGuardarConciliacionMayor()">Cancelar</button>
            <button class="btn-confirmar-eliminar" style="background: #28a745;" onclick="ejecutarGuardarConciliacionMayor()">üíæ Guardar</button>
        </div>
    </div>

    <!-- Navegaci√≥n global -->
    <script src="../../shared/globalNav.js"></script>
    <!-- Script principal -->
    <script src="script.js"></script>
    <!-- Script del m√≥dulo de mayores -->
    <script src="mayores.js"></script>
</body>
</html>
